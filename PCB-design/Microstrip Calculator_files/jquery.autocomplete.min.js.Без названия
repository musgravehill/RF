!function($){function fnFormatResult(e,t,s){var i="("+s.replace(reEscape,"\\$1")+")";return e.replace(new RegExp(i,"gi"),"<strong>$1</strong>")}function Autocomplete(e,t){this.el=$(e),this.el.attr("autocomplete","off"),this.suggestions=[],this.data=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.el.val(),this.intervalId=0,this.cachedResponse=[],this.onChangeInterval=null,this.ignoreValueChange=!1,this.serviceUrl=t.serviceUrl,this.isLocal=!1,this.options={autoSubmit:!1,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:!0,params:{},fnFormatResult:fnFormatResult,delimiter:null,ShowImage:!1,zIndex:9999},this.initialize(),this.setOptions(t)}var reEscape=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g");$.fn.autocomplete=function(e){return new Autocomplete(this.get(0),e)},Autocomplete.prototype={killerFn:null,initialize:function(){var e,t,s;e=this,t=(new Date).getTime(),s="Autocomplete_"+t,this.killerFn=function(t){0===$(t.target).parents(".autocomplete").size()&&(e.killSuggestions(),e.disableKillerFn())},!this.options.width,this.mainContainerId="AutocompleteContainter_"+t,$('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;" class="autocomplete-wrapper"><div class="autocomplete-w1"><div class="autocomplete" id="'+s+'" style="display:none;"></div></div></div>').appendTo("body"),this.container=$("#"+s),this.fixPosition(),window.opera?this.el.keypress(function(t){e.onKeyPress(t)}):this.el.keydown(function(t){e.onKeyPress(t)}),this.el.keyup(function(t){e.onKeyUp(t)}),this.el.blur(function(){e.enableKillerFn()}),this.el.focus(function(){e.fixPosition()})},setOptions:function(e){var t=this.options;$.extend(t,e),t.lookup&&(this.isLocal=!0,$.isArray(t.lookup)&&(t.lookup={suggestions:t.lookup,data:[]})),$("#"+this.mainContainerId).css({zIndex:t.zIndex});var s=t.width;250>s&&(s=250)},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var e=this.el.offset();$("#"+this.mainContainerId).css({top:e.top+this.el.innerHeight()+"px",left:e.left+"px"})},enableKillerFn:function(){var e=this;$(document).bind("click",e.killerFn)},disableKillerFn:function(){var e=this;$(document).unbind("click",e.killerFn)},killSuggestions:function(){var e=this;this.stopKillSuggestions(),this.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(e){if(!this.disabled&&this.enabled){switch(e.keyCode){case 27:this.el.val(this.currentValue),this.hide();break;case 9:case 13:if(-1===this.selectedIndex)return void this.hide();if(this.select(this.selectedIndex),9===e.keyCode)return;break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){if(!this.disabled){switch(e.keyCode){case 38:case 40:return}if(clearInterval(this.onChangeInterval),this.currentValue!==this.el.val())if(this.options.deferRequestBy>0){var t=this;this.onChangeInterval=setInterval(function(){t.onValueChange()},this.options.deferRequestBy)}else this.onValueChange()}},onValueChange:function(){clearInterval(this.onChangeInterval),this.currentValue=this.el.val();var e=this.getQuery(this.currentValue);return this.selectedIndex=-1,this.ignoreValueChange?void(this.ignoreValueChange=!1):void(""===e||e.length<this.options.minChars?this.hide():this.getSuggestions(e))},getQuery:function(e){var t,s;return(t=this.options.delimiter)?(s=e.split(t),$.trim(s[s.length-1])):$.trim(e)},getSuggestionsLocal:function(e){var t,s,i,n,o;for(s=this.options.lookup,i=s.suggestions.length,t={suggestions:[],data:[]},e=e.toLowerCase(),o=0;i>o;o++)n=s.suggestions[o],0===n.toLowerCase().indexOf(e)&&(t.suggestions.push(n),t.data.push(s.data[o]));return t},getSuggestions:function(e){var t,s;t=this.isLocal?this.getSuggestionsLocal(e):this.cachedResponse[e],t&&$.isArray(t.suggestions)?(this.suggestions=t.suggestions,this.data=t.data,this.suggest()):this.isBadQuery(e)||(s=this,s.options.params.query=e,$.get(this.serviceUrl,s.options.params,function(e){s.processResponse(e)},"text"))},isBadQuery:function(e){for(var t=this.badQueries.length;t--;)if(0===e.indexOf(this.badQueries[t]))return!0;return!1},hide:function(){this.enabled=!1,this.selectedIndex=-1,this.container.hide()},suggest:function(){if(0===this.suggestions.length)return void this.hide();var e,t,s,i,n,o,a,l,r;for(e=this,t=this.suggestions.length,i=this.options.fnFormatResult,n=this.getQuery(this.currentValue),l=function(t){return function(){e.activate(t)}},r=function(t){return function(){e.select(t)}},this.container.hide().empty(),o=0;t>o;o++){if(a=this.suggestions[o].replace(/&quot;/gi,"'"),this.options.ShowImage){var h=this.data[o].split("$$$"),u=h[0],c=h[1],d=h[2],g=h[3];s=$((e.selectedIndex===o?'<div class="selected"':"<div")+' title="'+a+'"><table class="tblAutoComplete" width="230"><tr><td width="70"><img src="'+u+'" /></td><td width="160" class="tdAutoComplete"><span class="productCat">'+d+'</span><span class="productName">'+c+'</span><span class="productPrice">$'+g+"</span></td></tr></table></div>")}else s=$((e.selectedIndex===o?'<div class="selected"':"<div")+' title="'+a+'">'+i(a,this.data[o],n)+"</div>");s.mouseover(l(o)),s.click(r(o)),this.container.append(s)}this.enabled=!0,this.container.show()},processResponse:function(text){text.indexOf('<div align="center">')>0&&(text=text.substring(0,text.indexOf('<div align="center">')));var response;try{response=eval("("+text+")")}catch(err){return}$.isArray(response.data)||(response.data=[]),this.cachedResponse[response.query]=response,0===response.suggestions.length&&this.badQueries.push(response.query),response.query===this.getQuery(this.currentValue)&&(this.suggestions=response.suggestions,this.data=response.data,this.suggest())},activate:function(e){var t,s;return t=this.container.children(),-1!==this.selectedIndex&&t.length>this.selectedIndex&&$(t.get(this.selectedIndex)).attr("class",""),this.selectedIndex=e,-1!==this.selectedIndex&&t.length>this.selectedIndex&&(s=t.get(this.selectedIndex),$(s).attr("class","selected")),s},deactivate:function(e,t){e.className="",this.selectedIndex===t&&(this.selectedIndex=-1)},select:function(e){var t,s;t=this.suggestions[e],t&&(this.el.val(t),this.options.autoSubmit&&(s=this.el.parents("form"),s.length>0&&s.get(0).submit()),this.ignoreValueChange=!0,this.hide(),this.onSelect(e))},moveUp:function(){return-1!==this.selectedIndex?0===this.selectedIndex?(this.container.children().get(0).className="",this.selectedIndex=-1,void this.el.val(this.currentValue)):void this.adjustScroll(this.selectedIndex-1):void 0},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(e){var t,s,i;t=this.activate(e),s=t.offsetTop,i=this.container.scrollTop()},onSelect:function(e){var t,s,i,n,o;t=this,s=t.options.onSelect,i=function(e){e=e.replace(/&quot;/gi,"'");var s,i,n;return(s=t.options.delimiter)?(i=t.currentValue,n=i.split(s),1===n.length?e:i.substr(0,i.length-n[n.length-1].length)+e):e},n=t.suggestions[e],o=t.data[e],t.el.val(i(n)),$.isFunction(s)&&s(n,o)}}}(jQuery);