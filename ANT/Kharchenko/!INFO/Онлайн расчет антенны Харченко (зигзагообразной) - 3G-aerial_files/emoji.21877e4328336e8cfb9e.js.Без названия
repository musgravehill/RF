!function(e){function t(t){for(var r,s,a=t[0],c=t[1],l=t[2],u=0,f=[];u<a.length;u++)s=a[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&f.push(n[s][0]),n[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(d&&d(t);f.length;)f.shift()();return o.push.apply(o,l||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],r=!0,a=1;a<i.length;a++){var c=i[a];0!==n[c]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=i[0]))}return e}var r={},n={"web/emoji":0},o=[];function s(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(){return Promise.resolve()},s.m=e,s.c=r,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/js/cmodules/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;o.push([189,"evbus","lottie","common","palette"]),i()}({189:function(e,t,i){e.exports=i("5Y++")},"5Y++":function(e,t,i){"use strict";i.r(t);var r=i("lBJi");window.Emoji||(window.Emoji=r.Emoji);try{window.stManager.done(window.jsc("web/emoji.js"))}catch(e){}},"9R94":function(e,t,i){"use strict";i.r(t);t.default=function(e,t){if(!e)throw new Error("Invariant failed")}},hC3G:function(e,t,i){"use strict";i.r(t),i.d(t,"PINNED_CONVERSATION_BIT_MASK",(function(){return r})),i.d(t,"MASS_MENTION_ALIASES",(function(){return n})),i.d(t,"MASS_MENTION_REGEXP",(function(){return o})),i.d(t,"VK_OFFICIAL_PEER_ID",(function(){return s}));i("Oyvg");var r=112,n={all:["all","everyone","все"],online:["online","here","здесь","тут"]},o=new RegExp(['(?!,|;|:|\\.|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(n.all).concat(n.online).map(e=>`@${e}|\\*${e}`).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),s=-22822305},lBJi:function(e,t,i){"use strict";i.r(t),i.d(t,"Emoji",(function(){return hi}));i("a1Th"),i("rE2o"),i("ioFf"),i("Vd3H"),i("91GP"),i("VRzm"),i("KKXr"),i("rGqo"),i("Btvt"),i("HEwt"),i("Oyvg"),i("SRfc"),i("pIFo");var r=i("S6+Z"),n=i("TxR4"),o=i("yqpO"),s={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},a=Object.keys(s).reduce((e,t)=>(e[t]=s[t].map(e=>Object(n.emojiSymbolToByteHex)(e)),e),{});i("hhXQ");function c(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}var l=i("W9Tc"),d=i("t7n3"),u=i("zxIV"),f=(i("/8Fb"),i("821F"));function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var h=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],v=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],g=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],k=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],S=new RegExp(`(${k.join(")|(")})`);function w(e,t){return"amount"===e?function(e){var t=e.match(S);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var b=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...h,...v,...g,...k].join("|")}))+)\\s*$`),y=new RegExp(`(${h.join("|")})|(${v.join("|")})|(${g.join("|")})|(${k.join("|")})`,"gi"),j={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.toLowerCase().replace(/ё/g,"е").match(b);if(t){for(var i={input:e,request:t[1],send:t[2],context:t[3]};t=y.exec(i.context),t;)for(var r={receiver:t[1],subject:t[2],method:t[3],amount:t[4]},n=0,o=Object.entries(r);n<o.length;n++){var s=m(o[n],2),a=s[0],c=s[1];c&&(i[a]=w(a,c))}if(i.subject||i.method||i.amount)return i}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.introViewed){var o=[e,t,i,r].join("_");f.MoneyTransfer.showMoneyTransferBox({tab:i,amount:r,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===o},void 0,()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=n.onSendStart)}),this.lastBoxId=o}else showWiki(_({w:"moneysend_promo",fromId:e,toId:t,action:i},r?{amount:r}:{})),this.introViewed=!0}},E=i("jE6c");function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}var I=Object.entries(r.EMOJI_HINTS).map(e=>{var t=T(e,2),i=t[0],r=T(t[1],2),n=(r[0],r[1]);return[new RegExp(`(\\s|^)(${Object(E.escapeRE)(n)}${n.endsWith(")")||n.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),i]}),O={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?O["\\"]="ё":O["`"]="ё";var R=new RegExp(`[${Object(E.escapeRE)(Object.keys(O).join(""))}]`,"gi"),P=e=>e.replace(R,e=>O[e]),N=Object.entries(O).reduce((e,t)=>{var i=T(t,2),r=i[0];return e[i[1]]=r,e}),L=new RegExp(`[${Object(E.escapeRE)(Object.keys(N).join(""))}]`,"gi"),x=e=>e.replace(L,e=>N[e]);var B,A=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=I.reduce((e,t)=>{var i=T(t,2),r=i[0],o=i[1];return e.replace(r,(e,t,i,r)=>(t||"")+Object(n.emojiByteHexToSymbol)(o)+(r||""))},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var r=[e=Object(n.emojiRemoveSkinToneModifiers)(e)],o=0,s=[...r];o<s.length;o++){var a=s[o];r.push(P(a)),r.push(x(a))}for(var c=0,l=[...r];c<l.length;c++){var d=l[c];r.push(d.replace(/ё/g,"е")),r.push(d.replace(/е/g,"ё"))}for(var u=0,f=[...r];u<f.length;u++){var _=f[u];r.push(_.replace(/[.!?]+$/,""))}return Object.keys(r.reduce((e,t)=>(e[t]=1,e),{}))}isBotLinkEnabled(){return Object(l.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId}getBotLinkUrl(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"}getBotLinkImageUrl(e){return`/images/stickers_suggestions_bot_${arguments.length>1&&void 0!==arguments[1]?arguments[1]:"light"}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return Object(l.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}},H=i("QGEU"),M=i("v+DW"),D=i("EasH"),F=i("FWc3"),K=i("4+be"),G=i("ZxpX"),z=i("rudk");!function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(B||(B={}));var W,V=Symbol(),U=Symbol();!function(e){e.IsNew="is_new"}(W||(W={}));var Y,q=function(e){return void 0!==e.sticker_ids},$=function(e){return void 0!==e.base_id},X=function(e){return q(e)&&!$(e)};!function(e){e.Pack="pack",e.Style="style"}(Y||(Y={}));var J,Q,Z,ee,te=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(X(e)?this.pack.add(e):$(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}(),ie=(function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(X(t)?this.pack.push(e):$(t)&&this.style.push(e))}}(),{square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}}),ne=(B.LIGHT,B.LIGHT,B.LIGHT,B.LIGHT,B.LIGHT,B.LIGHT,B.DARK,B.DARK,B.DARK,B.DARK,B.DARK,B.DARK,{"64_png":{id:"64.png",width:64,height:64,theme:B.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:B.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:B.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:B.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:B.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:B.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:B.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:B.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:B.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:B.DARK}}),oe=((J={})[B.LIGHT]="animation.json",J[B.DARK]="animation.b.json",J),ae={products:(Q=[],new Map(Q)),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map};!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(Z||(Z={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(ee||(ee={}));var le=function(e,t,i,r){void 0===r&&(r=B.DEFAULT);var n=window.devicePixelRatio,o=[t*=n,i*=n,r].toString(),s=e[U];if(s&&s.has(o)){var a=s.get(o);if(a)return a}s||(s=new Map,e[U]=s);var c=function(e){var t=e[V];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[V]=t),t}(e).filter((function(e){return!e.theme||e.theme===r})),l=c.find((function(e){return e.width>=t&&e.height>=i}))||c[c.length-1];return s.set(o,l),l},de=function(e,t,i,r){return void 0===r&&(r=B.DEFAULT),function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,i){return void 0===i&&(i=B.DEFAULT),le(ne,e,t,i)}(t,i,r))},ue=function(e,t,i,r){return void 0===r&&(r=B.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,i){return void 0===i&&(i=B.DEFAULT),le(ie,e,t,i)}(t,i,r))},fe=function(e){return-1===e.recipient_id},_e=i("3oLO"),me=i("Xrg9"),pe=function(){return(pe=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},he=function(){if(!window.stickersCache){var e=me.default.get("stickers_cache");window.stickersCache=pe(pe({},ae),e)}return window.stickersCache},ve=function(e){window.stickersCache=pe(pe({},he()),e)},ke=function(e){return he().stickers.get(e)},Se=function(e){var t=ke(e);if(!t||!t.pack_id)return null;var i=ye(t.pack_id);return i&&q(i)?i:null},we=function(){return(we=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},be=function(e,t){void 0===t&&(t=[]);var i=he();if(e.stickers)for(var r=i.stickers,n=0,o=e.stickers;n<o.length;n++){var s=o[n];r.has(s.id)?r.set(s.id,we(we({},r.get(s.id)),s)):r.set(s.id,s)}if(e.products)for(var a=0,c=e.products;a<c.length;a++){var l=c[a];i.products.set(l.id,l),i.productPromises.delete(l.id)}for(var d=0,u=t;d<u.length;d++){var f=u[d];i.products.has(f)||i.products.set(f,null),i.productPromises.delete(f)}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),ve(i)},ye=function(e){return he().products.get(e)},je=function(e){var t=he().products;return e.map((function(e){return t.get(e)}))};var Ee=function(e){if(!e.length)return Promise.resolve([]);for(var t,i=he(),r=i.productPromises,n=i.productIdsQueue,o=new Set,s=0,a=e;s<a.length;s++){var c=a[s];if(r.has(c)){(l=r.get(c))&&o.add(l)}else{n.add(c);var l=(t=void 0,(t=he().productsPromise)||(t=new Promise((function(e){return setTimeout((function(){var t=he().productIdsQueue,i=Array.from(t);t.clear(),ve({productIdsQueue:t,productsPromise:void 0}),_e.ajax.post("stickers.php",{act:"get_products",product_ids:i},{onDone:function(t){be(t,i),e()},onFail:function(t){return console.error(t),be({},i),e(),!0}})}),300)})),ve({productsPromise:t})),t);r.set(c,l),o.add(l)}}return ve({productIdsQueue:n,productPromises:r}),Promise.all(o).then((function(){return je(e)}))},Te=function(e,t){void 0===t&&(t=!0);var i=t?e.filter((function(e){return void 0===ye(e)})):e;return i.length?Ee(i).then((function(){return je(e)})):Promise.resolve(je(e))},Ce=function(e,t,i,r){return void 0===r&&(r=!0),new Promise((function(n){_e.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:i},{onDone:function(e){r&&be(e),n()},onFail:function(e){return console.error(e),n(),!0}})}))},Ie=i("q1tI"),Oe=i.n(Ie),Re=i("i8i4"),Pe=i.n(Re),Ne=i("Syzc"),Le=function(){return(Le=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},xe=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)r[n]=o[s];return r},Be=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,i){return void 0===i&&(i=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),i)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return Te(t).then((function(){for(var t=0,i=Array.from(e.items.values());t<i.length;t++){var r=i[t];r.product=ye(r.product_id)}}))},e.prototype.getProducts=function(){return je(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var i={product_id:e,amount:1};t?this.setItems(xe(this.getItems(),[i])):this.setItems(xe([i],this.getItems())),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[-1]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){if(this._order=e,e){this.recipientIds.clear();for(var t=0,i=e.items;t<i.length;t++){var r=i[t];-1!==r.recipient_id&&this.recipientIds.add(r.recipient_id)}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return Te(t).then((function(t){return Le(Le({},e),{items:e.items.map((function(e,i){return Le(Le({},e),{product:t[i]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map(xe(this.getRecipients(),e).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return Le(Le({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(i){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new Ne.AjaxCancellationToken,_e.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){be(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(r){var n=r[1];t.setOrder(n),e.recipients&&t.addRecipients(e.recipients),i(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),i(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(i){_e.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){be(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var r=e[0],n=e[1];t.setOrder(r),i(n)}),(function(){}))},onFail:function(e){return e&&console.error(e),i(null),!0}})}))},e}(),Ae=i("6krn"),He=i("kcIO"),Me=Ae.default.getLang;function De(){return document.querySelector("#box_loader")}function Fe(){return document.querySelector("#box_layer_wrap")}function Ke(){var e=De();Object(He.boxRefreshCoords)(e),Object(u.show)(e),Object(u.show)(Fe())}function Ge(){Object(u.hide)(De())}function ze(e){var t=new te(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),i=t.getPack(),r=t.getStyles();if(i)return r.length?Object(K.langStr)(Me("purchases_stickers_purchase_result_pack_and_styles",r.length),"pack_title",i.title,"n",r.length):Object(K.langStr)(Me("purchases_stickers_purchase_result_pack"),"title",i.title);if(r.length)switch(r.length){case 1:return Object(K.langStr)(Me("purchases_stickers_purchase_result_1_style"),"title",r[0].title);case 2:return Object(K.langStr)(Me("purchases_stickers_purchase_result_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return Object(K.langStr)(Me("purchases_stickers_purchase_result_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return Object(K.langStr)(Me("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:var n=r.length-3;return Object(K.langStr)(Me("purchases_stickers_purchase_result_3_styles_and_n_more",n),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",n)}return null}var We=i("85vT"),Ve=i("BiHW"),Ue=i("WfnU"),Ye=function(e){var t=Object(Ie.useState)({})[1],i=ye(e);return void 0===i?(function(e,t){if(void 0===t&&(t=!0),t){var i=ye(e);if(void 0!==i)return Promise.resolve(i)}return Ee([e]).then((function(){return ye(e)}))}(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]},qe=function(e){var t=Ye(e),i=t[0],r=t[1];return i&&X(i)?[i,r]:[void 0===i?void 0:null,r]},$e=function(e){var t=Object(Ie.useState)({})[1],i=je(e);return i.some((function(e){return void 0===e}))?(Te(e,!1).then((function(){return t({})}),(function(){})),[i,!0]):[i,!1]},Xe=function(e){for(var t=$e(e),i=t[0],r=t[1],n=[],o=0,s=i;o<s.length;o++){var a=s[o];a&&$(a)&&n.push(a)}return[n,r]},Je=function(){return(Je=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};var Qe=function(e){var t=Object(Ie.useState)(e),i=t[0],r=t[1],n=Object(Ie.useState)(null),o=n[0],s=n[1],a=Object(Ie.useCallback)((function(){var e=i.load();s(e),e.then((function(t){r(t),s((function(t){return t===e?null:t}))}),(function(){}))}),[i]);return Object(Ie.useEffect)((function(){return i.onChange=a,i.isLoaded()||a(),function(){i.onChange=null,i.cancelLoad()}}),[i]),[i,null!==o]},Ze=i("9R94");function et(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function tt(){return(tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var rt=new Map,nt=new Map,ot=new Map,st=0;function at(e,t,i){void 0===i&&(i={}),i.threshold||(i.threshold=0);var r=i,n=r.root,o=r.rootMargin,s=r.threshold;if(rt.has(e)&&Object(Ze.default)(!1),e){var a=function(e){return e?ot.has(e)?ot.get(e):(st+=1,ot.set(e,st.toString()),ot.get(e)+"_"):""}(n)+(o?s.toString()+"_"+o:s.toString()),c=nt.get(a);c||(c=new IntersectionObserver(lt,i),a&&nt.set(a,c));var l={callback:t,element:e,inView:!1,observerId:a,observer:c,thresholds:c.thresholds||(Array.isArray(s)?s:[s])};return rt.set(e,l),c.observe(e),l}}function ct(e){if(e){var t=rt.get(e);if(t){var i=t.observerId,r=t.observer,n=r.root;r.unobserve(e);var o=!1,s=!1;i&&rt.forEach((function(t,r){r!==e&&(t.observerId===i&&(o=!0,s=!0),t.observer.root===n&&(s=!0))})),!s&&n&&ot.delete(n),r&&!o&&r.disconnect(),rt.delete(e)}}}function lt(e){e.forEach((function(e){var t=e.isIntersecting,i=e.intersectionRatio,r=e.target,n=rt.get(r);if(n&&i>=0){var o=n.thresholds.some((function(e){return n.inView?i>e:i>=e}));void 0!==t&&(o=o&&t),n.inView=o,n.callback(o,e)}}))}var dt=function(e){var t,i;function r(){for(var t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return et(it(t=e.call.apply(e,[this].concat(r))||this),"state",{inView:!1,entry:void 0}),et(it(t),"node",null),et(it(t),"handleNode",(function(e){t.node&&(ct(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),et(it(t),"handleChange",(function(e,i){(e!==t.state.inView||e)&&t.setState({inView:e,entry:i}),t.props.onChange&&t.props.onChange(e,i)})),t}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.componentDidMount=function(){this.node||Object(Ze.default)(!1)},n.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(ct(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(ct(this.node),this.node=null)},n.componentWillUnmount=function(){this.node&&(ct(this.node),this.node=null)},n.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,i=e.root,r=e.rootMargin;at(this.node,this.handleChange,{threshold:t,root:i,rootMargin:r})}},n.render=function(){var e=this.state,t=e.inView,i=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:i,ref:this.handleNode});var r=this.props,n=r.children,o=r.as,s=r.tag,a=(r.triggerOnce,r.threshold,r.root,r.rootMargin,r.onChange,function(e,t){if(null==e)return{};var i,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)i=o[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}(r,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return Object(Ie.createElement)(o||s||"div",tt({ref:this.handleNode},a),n)},r}(Ie.Component);et(dt,"displayName","InView"),et(dt,"defaultProps",{threshold:0,triggerOnce:!1});var ut={inView:!1,entry:void 0};var ft=function(e){var t=e.className,i=e.sticker,r=e.theme,n=e.width,o=e.height,s=e.isInView,a=void 0===s||s,c=Oe.a.useRef(null),l=de(i,n,o,r);return Oe.a.useLayoutEffect((function(){c.current&&c.current.src!==l&&a&&(c.current.src=l)}),[a,l]),Oe.a.createElement("div",{className:Object(G.classNames)("StickerImage",t),style:{width:n,height:o}},Oe.a.createElement("img",{className:"StickerImage__image",ref:c}))},_t=i("lPHp"),mt=i.n(_t),pt=function(){return(pt=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ht=function(e){var t=e.className,i=e.sticker,r=e.theme,n=e.width,o=e.height,s=e.isInView,a=void 0===s||s,c=e.play,l=void 0!==c&&c,d=Oe.a.useRef(null),u=Oe.a.useState(null),f=u[0],_=u[1],m=function(e,t){return void 0===t&&(t=B.DEFAULT),e.animation?e.animation.base_url+"/"+oe[t]:""}(i,r);return Oe.a.useEffect((function(){if(f&&f.isLoaded){var e=l&&a;e&&!f.playing&&(f.item.play(),_(pt(pt({},f),{playing:!0}))),!e&&f.playing&&(f.item.pause(),_(pt(pt({},f),{playing:!1})))}}),[f,l,a]),Oe.a.useEffect((function(){if(!f||f.url!==m)if(f&&f.item.destroy(),m&&a){var e=mt.a.loadAnimation({container:d.current,path:m,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:m,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){_(pt(pt({},t),{isLoaded:!0}))})),_(t)}else _(null)}),[m,a]),Oe.a.createElement("div",{className:Object(G.classNames)("StickerAnimation",t),style:{width:n,height:o},ref:d})},vt=function(e){var t=e.className,i=e.sticker,r=e.theme,n=void 0===r?B.LIGHT:r,o=e.width,s=e.height,a=function(e){void 0===e&&(e={});var t=Object(Ie.useRef)(),i=Object(Ie.useState)(ut),r=i[0],n=i[1],o=Object(Ie.useCallback)((function(i){t.current&&ct(t.current),i&&at(i,(function(t,r){n({inView:t,entry:r}),t&&e.triggerOnce&&ct(i)}),e),t.current=i}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return Object(Ie.useEffect)((function(){t.current||r===ut||e.triggerOnce||n(ut)})),[o,r.inView,r.entry]}({threshold:0}),c=a[0],l=a[1],d=void 0!==i.animation,u=Oe.a.useState(!1),f=u[0],_=u[1];return Oe.a.createElement("div",{className:Object(G.classNames)("Sticker",t),ref:c,onMouseEnter:function(){_(!0)},onMouseLeave:function(){_(!1)}},d?Oe.a.createElement(ht,{sticker:i,theme:n,width:o,height:s,isInView:l,play:f}):Oe.a.createElement(ft,{sticker:i,theme:n,width:o,height:s,isInView:l}))},gt=i("IrTF"),kt=i("JxXo"),St=i("b8Q7"),wt=function(){return(wt=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},bt={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function yt(e,t){switch(t.type){case"updateState":return wt(wt({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?wt(wt({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var jt=function(e){for(var t=Array.from(e.entries()),i=0;i<t.length;i++){var r=t[i],n=r[0],o=r[1];if(o&&o.intersectionRatio)return o.intersectionRatio<1?n:t[i-1]?t[i-1][0]:null}return null},Et=function(e){for(var t=Array.from(e.entries()),i=t.length-1;i>=0;i--){var r=t[i],n=r[0],o=r[1];if(o&&o.intersectionRatio)return o.intersectionRatio<1?n:t[i+1]?t[i+1][0]:null}return null};var Tt=function(e){var t=Oe.a.useRef(null),i=Oe.a.useReducer(yt,bt),r=i[0],n=i[1],o=Oe.a.useCallback((function(e){n({type:"updateState",state:e})}),[n]),s=Oe.a.useCallback((function(i){if(t.current&&r.onMouseWheel&&t.current.removeEventListener("mousewheel",r.onMouseWheel),i){var s=i.querySelector(e.wrapperSelector);if(s){var a,c={x:0,y:0},l=new Map,d=function(t){var r=0;s.offsetWidth>i.offsetWidth&&(r=Math.max(0,Math.min(s.offsetWidth-i.offsetWidth,t.x)));var n=0;s.offsetHeight>i.offsetHeight&&(n=Math.max(0,Math.min(s.offsetHeight-i.offsetHeight,t.y))),s.style.transform="translate3d(-"+r+"px, -"+n+"px, 0)",s.style.transitionDuration=t.noTransition?"0s":"",c={x:r,y:n},e.onScroll&&e.onScroll(r,n)},u=function(e){d(wt(wt({},e),{x:c.x+e.x,y:c.y+e.y}))},f=function(e){e.deltaX&&e.preventDefault()};i.addEventListener("mousewheel",f),o(wt(wt({},r),{onMouseWheel:f,updateItems:function(){a&&a.disconnect(),a=new IntersectionObserver((function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];l.has(r.target)&&l.set(r.target,r)}n({type:"updateNav",hasPrev:null!==jt(l),hasNext:null!==Et(l)})}),{root:i,threshold:[0,1]}),l.clear();for(var t=0,r=i.querySelectorAll(e.itemSelector);t<r.length;t++){var o=r[t];l.set(o,null),a.observe(o)}},getOffset:function(){return c},scrollTo:d,scrollBy:u,onWheel:function(e){u({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=jt(l);if(e){var t=getComputedStyle(s),i=parseInt(t.paddingLeft)||0,r=parseInt(t.paddingTop)||0,n=s.getBoundingClientRect(),o=e.getBoundingClientRect();d({x:o.left-n.left-i,y:o.top-n.top-r})}},next:function(){var e=Et(l);if(e){var t=getComputedStyle(s),r=parseInt(t.paddingBottom)||0,n=parseInt(t.paddingRight)||0,o=i.getBoundingClientRect(),a=s.getBoundingClientRect(),c=e.getBoundingClientRect();d({x:c.left-a.left-o.width+c.width+n,y:c.top-a.top-o.height+c.height+r})}}}))}}t.current=i}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return Oe.a.useLayoutEffect((function(){r.updateItems()})),wt({ref:s},r)},Ct=Ae.default.getLang,It=function(e){var t,i=e.className,r=e.style,n=e.isAdded,o=void 0!==n&&n,s=e.add,a=e.remove,c=e.gift,l=e.isActive,d=e.isSelected,u=e.select;t=r.is_new?r.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):r.title;var f=ke(r.style_sticker_ids[0]),_=function(e){return function(t){t.stopPropagation(),e()}};return Oe.a.createElement("div",{className:Object(G.classNames)("StickerStylesMenuItem",i,{"StickerStylesMenuItem--selected":Boolean(d),"StickerStylesMenuItem--added":Boolean(o),"StickerStylesMenuItem--new":r.is_new}),onClick:function(){u?u():o?a&&a():s&&s()}},f&&Oe.a.createElement(vt,{className:"StickerStylesMenuItem__icon",sticker:f,width:100,height:100}),Oe.a.createElement(We.default,{element:"div",className:"StickerStylesMenuItem__title"},t),r.is_purchased?void 0===l?Oe.a.createElement("div",{className:"StickerStylesMenuItem__notice"},Ct("purchases_stickers_you_have_it")):l&&Oe.a.createElement("div",{className:"StickerStylesMenuItem__notice"},Ct("purchases_stickers_active_style")):r.price.purchase.regular?Oe.a.createElement("div",{className:"StickerStylesMenuItem__price"},Ct("global_n_votes",r.price.purchase.current)):Oe.a.createElement("div",{className:"StickerStylesMenuItem__price"},Ct("purchases_for_free_btn")),(s||a||c&&r.can_gift)&&Oe.a.createElement("div",{className:"StickerStylesMenuItem__actions"},o?a&&Oe.a.createElement(Ve.default,{className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:_(a)},Ct("purchases_stickers_preview_remove_item")):s&&Oe.a.createElement(Ve.default,{className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:_(s)},Ct("purchases_stickers_preview_add_item")),c&&r.can_gift&&Oe.a.createElement(Ve.default,{className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:_(c)})))},Ot=Ae.default.getLang,Rt=function(e){var t=e.className,i=e.styles,r=e.isLoading,n=e.isAdded,o=e.add,s=e.remove,a=e.gift,c=e.activeStyle,l=e.selectedStyle,d=e.select,u=Tt({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(r)return Oe.a.createElement("section",{className:Object(G.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},Oe.a.createElement(gt.default,{className:"StickerStylesMenu__progress"}));var f=[{title:Ot("purchases_stickers_purchased_styles"),styles:i.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:Ot("purchases_stickers_other_styles"),styles:i.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:Ot("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return f.length?Oe.a.createElement("section",{className:Object(G.classNames)("StickerStylesMenu",t),ref:u.ref,onWheel:function(e){return u.onWheel(e)}},Oe.a.createElement("a",{className:Object(G.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!u.hasPrev}),onClick:function(){return u.prev()}}),Oe.a.createElement("a",{className:Object(G.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!u.hasNext}),onClick:function(){return u.next()}}),Oe.a.createElement("div",{className:"StickerStylesMenu__wrapper"},f.map((function(e,t){return Oe.a.createElement("section",{className:"StickerStylesMenu__group",key:t},Oe.a.createElement("h2",{className:"StickerStylesMenu__groupTitle"},e.title,e.tooltip&&Oe.a.createElement(kt.default,{className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},Oe.a.createElement(St.default,{className:"StickerStylesMenu__groupTitleHintIcon"}))),Oe.a.createElement("div",{className:"StickerStylesMenu__groupItems"},e.styles.map((function(e){return Oe.a.createElement(It,{className:"StickerStylesMenu__item",style:e,isLoading:r,isAdded:n&&n(e),add:o&&function(){return o(e)},remove:s&&function(){return s(e)},gift:a&&function(){return a(e)},isActive:void 0===c?void 0:e===c,isSelected:void 0===l?void 0:e===l,select:d&&function(){return d(e)},key:e.id})}))))})))):null},Pt=function(e){var t=e.className,i=e.product;if(!X(i)&&!$(i))return null;var r=function(e){var t=he().stickers;return e.map((function(e){return t.get(e)}))}($(i)?i.style_sticker_ids:i.sticker_ids);return Oe.a.createElement("div",{className:Object(G.classNames)("StickersProductPreview",t)},Oe.a.createElement("ul",{className:"StickersProductPreview__stickers"},r.map((function(e){return e&&Oe.a.createElement(vt,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,key:e.id})}))))},Nt=Ae.default.getLang,Lt=function(e){var t=e.item,i=e.showHeader,r=void 0!==i&&i,n=e.remove;if(!t.product)return null;var o="";return X(t.product)?o=Object(K.langStr)(Nt("purchases_stickers_product_preview_title_pack"),"title",t.product.title):$(t.product)&&(o=Object(K.langStr)(Nt("purchases_stickers_product_preview_title_style"),"title",t.product.title)),Oe.a.createElement("div",{className:"StickersCartItem"},r&&Oe.a.createElement("div",{className:"StickersCartItem__header"},Oe.a.createElement(We.default,{element:"span",className:"StickersCartItem__title"},o),n&&Oe.a.createElement("span",{className:"StickersCartItem__actions"},Oe.a.createElement("button",{className:"StickersCartItem__remove",onClick:function(){return n()}},Nt("purchases_stickers_preview_remove_item")))),Oe.a.createElement(Pt,{className:"StickersCartItem__preview",product:t.product}))},xt=function(){return(xt=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},Bt=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i},At=Ae.default.getLang,Ht=function(e){var t=e.className,i=e.price,r=e.text,n=e.placeholder,o=Bt(e,["className","price","text","placeholder"]),s=Object(Ie.useMemo)((function(){if(i){var e;i.current!==i.regular&&i.regular&&(e=Oe.a.createElement("span",{className:"StickersPriceButton__regular",key:"regular"},i.current?i.regular:Object(K.langStr)(At("purchases_stickers_n_for_m"),"%n","","%m",At("global_n_votes",i.regular))));var t=Oe.a.createElement("span",{className:"StickersPriceButton__current",key:"current"},i.current?At("global_n_votes",i.current):At("purchases_for_free_btn").toLowerCase());return r?r.split(/(\{regular_price\}|\{price\})/).map((function(i,r){return"{regular_price}"===i?e:"{price}"===i?t:i?Oe.a.createElement("span",{className:"StickersPriceButton__label",key:"label"+r},i):void 0})):[e,t]}return[n]}),[r,n,null==i?void 0:i.regular,null==i?void 0:i.current]);return Oe.a.createElement(Ue.default,xt({className:Object(G.classNames)("StickersPriceButton",t)},o),s)};Ht.defaultProps=xt({},Ue.default.defaultProps);var Mt=Ht,Dt=i("euvX"),Ft=i("3blr"),Kt=i("s1Gz"),Gt=i("wQFj"),zt={s:56,m:96,l:168},Wt=function(e){var t,i,r,n=e.order,o=e.forceValid,s=void 0!==o&&o,a=new Map,c=new Map;if(n)for(var l=0,d=n.items;l<d.length;l++){var u=d[l],f=u.product;f&&(X(f)?a.has(f)?null===(t=a.get(f))||void 0===t||t.push(u):a.set(f,[u]):$(f)&&(c.has(f)?null===(i=c.get(f))||void 0===i||i.push(u):c.set(f,[u])))}var _=a.keys().next().value,m=(_?1:0)+c.size,p=m>1?m>2?"s":"m":"l",h=zt[p],v=Array.from(c.entries());s||v.sort((function(e,t){var i=e[1];return t[1].filter((function(e){return!e.error})).length-i.filter((function(e){return!e.error})).length}));var g=v.slice(0,3),k=v.slice(3),S=!0;if(!s){var w=k.filter((function(e){return e[1].find((function(e){return!e.error}))}));w.length?k=w:S=!1}return Oe.a.createElement("ul",{className:"StickerProductsGiftIcons"},_&&Oe.a.createElement("li",{className:Object(G.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!s&&!(null===(r=a.get(_))||void 0===r?void 0:r.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+ue(_,h,h)+")"},key:_.id}),g.map((function(e){var t=e[0],i=e[1];return Oe.a.createElement("li",{className:Object(G.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!s&&!i.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+ue(t,h,h)+")"},key:t.id})})),k.length?Oe.a.createElement("li",{className:Object(G.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+p,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!S}),key:"more"},"+",k.length):null)},Vt=Ae.default.getLang;var Ut=function(e){for(var t=e.order,i=e.recipients,r=function(e){if(!e)return null;var t=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),i=t.filter((function(e){return!e.error&&!fe(e)}));i.length&&(t=i);for(var r=[],n=[],o=0,s=t;o<s.length;o++){var a=s[o],c=a.product;c&&(X(c)?r.push(a):$(c)&&n.push(a))}var l=n.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(r.length){var d=r.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return n.length?Object(K.langStr)(Vt("purchases_stickers_gift_details_summary_pack_with_styles",n.length),"pack_price_sum",Vt("global_n_votes",d),"styles_num",n.length,"styles_price_sum",Vt("global_n_votes",l)):Object(K.langStr)(Vt("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",Vt("global_n_votes",d))}if(n.length)return Object(K.langStr)(Vt("purchases_stickers_gift_details_summary_styles",n.length),"styles_num",n.length,"styles_price_sum",Vt("global_n_votes",l));return null}(t),n=new Map,o=0,s=t.items;o<s.length;o++){var a=s[o],c=a.error,l=a.product,d=a.recipient_id;if(!c){var u=i.get(d);if(u){var f=n.get(u);f||(f=new te,n.set(u,f)),f.add(l)}}}var _=Array.from(n.entries()),m=Object(Ie.useRef)(null);return Object(Ie.useEffect)((function(){var e=m.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),Oe.a.createElement("div",{className:"StickerProductsGiftDetails",ref:m},r&&Oe.a.createElement(We.default,{element:"p",className:"StickerProductsGiftDetails__summary"},r),_.length>0&&Oe.a.createElement("ul",{className:"StickerProductsGiftDetails__recipients"},_.map((function(e){var t=e[0],i=e[1];return Oe.a.createElement("li",{className:"StickerProductsGiftDetails__recipient",key:t[0]},Oe.a.createElement(We.default,{element:"div",className:"StickerProductsGiftDetails__recipientName"},t[1]),Oe.a.createElement("div",{className:"StickerProductsGiftDetails__recipientProducts"},function(e){var t=e.getPack(),i=e.getStyles(),r="";i.length&&(r=i.map((function(e){return Object(K.langStr)(Vt("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", "));if(t)return r?Object(K.langStr)(Vt("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",r):Object(K.langStr)(Vt("purchases_stickers_gift_details_recipient_pack"),"title",t.title);if(r)return Object(K.langStr)(Vt("purchases_stickers_gift_details_recipient_styles"),"style_titles",r);return null}(i)))}))))},Yt=Ae.default.getLang;var qt=function(e){var t=e.cart,i=e.options,r=i.ref,n=i.gift_ref,o=e.closeBox,s=e.updateBox,a=Qe(t),c=a[0],l=a[1],d=!c.isLoaded()&&l;Object(Ie.useEffect)((function(){s()}),[d]);var u=c.getRecipientIds(),f=c.getOrder(),_=f&&!f.error&&f.items.find((function(e){return!e.error&&!fe(e)})),m=function(e){if(!e)return[null,null];for(var t,i=0,r=e.items;i<r.length;i++){var n=r[i].product;if(n&&X(n)){t=n;break}}var o=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),s=o.filter((function(e){return!e.error&&!fe(e)}));s.length&&(o=s);var a=new te(o.map((function(e){return e.product}))),c=a.pack.values().next().value,l=Array.from(a.style),d="",u="";if(1===l.length)d=Object(K.langStr)(Yt("purchases_stickers_gift_title_1_style"),"title",l[0].title),c?u=Object(K.langStr)(Yt("purchases_stickers_gift_description_with_pack"),"title",c.title):t&&(u=Object(K.langStr)(Yt("purchases_stickers_gift_description_for_pack"),"title",t.title));else if(c){if(d=Object(K.langStr)(Yt("purchases_stickers_gift_title_pack"),"title",c.title),l.length)switch(l.length){case 2:u=Object(K.langStr)(Yt("purchases_stickers_gift_description_with_2_styles"),"title1",l[0].title,"title2",l[1].title);break;case 3:u=Object(K.langStr)(Yt("purchases_stickers_gift_description_with_3_styles"),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title);break;case 4:u=Object(K.langStr)(Yt("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title);break;default:var f=l.length-3;u=Object(K.langStr)(Yt("purchases_stickers_gift_description_with_3_styles_and_n_more",f),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title,"n",f)}}else if(l.length){switch(l.length){case 2:d=Object(K.langStr)(Yt("purchases_stickers_gift_title_2_styles"),"title1",l[0].title,"title2",l[1].title);break;case 3:d=Object(K.langStr)(Yt("purchases_stickers_gift_title_3_styles"),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title);break;case 4:d=Object(K.langStr)(Yt("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title);break;default:f=l.length-3;d=Object(K.langStr)(Yt("purchases_stickers_gift_title_3_styles_and_n_more",f),"title1",l[0].title,"title2",l[1].title,"title3",l[2].title,"n",f)}t&&(u=Object(K.langStr)(Yt("purchases_stickers_gift_description_for_pack"),"title",t.title))}l.length?u+=" "+Yt("purchases_stickers_gift_description_styles"):u+=" "+Yt("purchases_stickers_gift_description");return[d,u]}(f),p=m[0],h=m[1],v=Object(Ie.useState)(null)[1];Object(Ie.useEffect)((function(){var e=c.getRecipients();if(v(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:e,items:e,noResult:Yt("gifts_nobody_found"),introText:Yt("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?c.addRecipientId(+t):c.removeRecipientId(+t)}})),u.length)for(var t=0,i=u;t<i.length;t++){var r=i[t],n=c.getRecipientById(r);n&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,n)}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[d]);var g=Object(Ie.useState)(""),k=g[0],S=g[1],w=Object(Ie.useState)(!1),b=w[0],y=w[1],j=Object(Ie.useState)(!1),E=j[0],T=j[1],C=function(){E||(T(!0),c.order({message:k,is_private:b,ref:r,gift_ref:n}).then((function(e){T(!1),e&&!e.error&&(Object(He.showDoneBox)(function(e,t){var i=new te(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),r=function(e){var t=e.getPack(),i=e.getStyles();if(t)return i.length?Object(K.langStr)(Yt("purchases_stickers_gift_result_products_pack_and_styles",i.length),"title",t.title,"styles_num",i.length):Object(K.langStr)(Yt("purchases_stickers_gift_result_products_pack"),"title",t.title);if(i.length)switch(i.length){case 1:return Object(K.langStr)(Yt("purchases_stickers_gift_result_products_1_style"),"title",i[0].title);case 2:return Object(K.langStr)(Yt("purchases_stickers_gift_result_products_2_styles"),"title1",i[0].title,"title2",i[1].title);case 3:return Object(K.langStr)(Yt("purchases_stickers_gift_result_products_3_styles"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);case 4:return Object(K.langStr)(Yt("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title);default:var r=i.length-3;return Object(K.langStr)(Yt("purchases_stickers_gift_result_products_3_styles_and_n_more",r),"title1",i[0].title,"title2",i[1].title,"title3",i[2].title,"n",r)}return null}(i);if(!r)return null;for(var n=new Set,o=0,s=e.items;o<s.length;o++){var a=s[o],c=a.error,l=a.recipient_id;if(!c){var d=t(l);d&&n.add(d)}}var u=function(e,t){var i=Array.from(e.values());switch(i.length){case 0:return null;case 1:var r=1===t?"purchases_stickers_gift_result_1_recipient_single":"purchases_stickers_gift_result_1_recipient_multiple";return Object(K.langStr)(Object(K.langSex)(i[0][7],Yt(r,!0)),"name",i[0][8]);case 2:return Object(K.langStr)(Yt("purchases_stickers_gift_result_2_recipients",t),"name1",i[0][8],"name2",i[1][8]);case 3:return Object(K.langStr)(Yt("purchases_stickers_gift_result_3_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8]);case 4:return Object(K.langStr)(Yt("purchases_stickers_gift_result_4_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8]);case 5:return Object(K.langStr)(Yt("purchases_stickers_gift_result_5_recipients",t),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"name5",i[4][8]);default:var n=i.length-4;r=1===t?"purchases_stickers_gift_result_4_recipients_and_n_more_single":"purchases_stickers_gift_result_4_recipients_and_n_more_multiple";return Object(K.langStr)(Yt(r),"name1",i[0][8],"name2",i[1][8],"name3",i[2][8],"name4",i[3][8],"n",n)}return null}(n,i.getCount());if(!u)return null;return Object(K.langStr)(u,"products",r)}(e,(function(e){return c.getRecipientById(e)}))),o())}),(function(){})))};return Object(Ie.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",E)}),[E]),Oe.a.createElement("article",{className:"StickerProductsGift"},Oe.a.createElement(Dt.ModalHeader,{className:"StickerProductsGift__header",title:Yt("purchases_stickers_gift_box_title"),appearance:"blue",onClose:o}),d?Oe.a.createElement("section",{className:"StickerProductsGift__content StickerProductsGift__content--loading"},Oe.a.createElement(Ft.default,{size:24})):Oe.a.createElement(Oe.a.Fragment,null,Oe.a.createElement("section",{className:"StickerProductsGift__content"},Oe.a.createElement(Wt,{order:f,forceValid:!_}),Oe.a.createElement("h1",{className:"StickerProductsGift__productsTitle"},p),Oe.a.createElement("p",{className:"StickerProductsGift__productsDescription"},h),f&&Oe.a.createElement(Oe.a.Fragment,null,Oe.a.createElement("dl",{className:"StickerProductsGift__price"},Oe.a.createElement("dt",{className:"StickerProductsGift__priceLabel"},Yt("purchases_gift_price_label"))," ",Oe.a.createElement("dd",{className:"StickerProductsGift__priceValue"},Yt("global_n_votes",f.price.current))),Oe.a.createElement("div",{className:"StickerProductsGift__balance"},Object(K.langStr)(Yt("gifts_you_have_X_votes"),"votes",Yt("global_n_votes",f.balance)))),Oe.a.createElement("div",{className:"StickerProductsGift__recipients"},Oe.a.createElement("label",{className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},Yt("gifts_receiver")),Oe.a.createElement("div",{className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},Oe.a.createElement("div",{className:"fl_r wdd_arr"}),Oe.a.createElement("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:Yt("gifts_choose_recipients")}))),Oe.a.createElement("div",{className:"StickerProductsGift__message"},Oe.a.createElement("label",{className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},Yt("purchases_gift_your_message")),Oe.a.createElement(Kt.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:k,onChange:function(e){return S(e.currentTarget.value)},onResize:function(){return s()},style:{height:80},disabled:E})),Oe.a.createElement(Gt.default,{className:"StickerProductsGift__isPrivate",checked:b,disabled:E,onChange:function(){return y(!b)}},Yt("gifts_receiver_only"))),Oe.a.createElement("footer",{className:"StickerProductsGift__footer"},Oe.a.createElement("div",{className:"StickerProductsGift__footerNote"},!l&&f&&Oe.a.createElement("div",{className:"StickerProductsGift__details"},Yt("purchases_stickers_gift_details_label"),Oe.a.createElement(kt.default,{className:"StickerProductsGift__detailsTooltip",text:Oe.a.createElement(Ut,{order:f,recipients:c.getRecipientsMap()}),position:"t",align:"center",appearance:"light"},Oe.a.createElement(St.default,{className:"StickerProductsGift__detailsHintIcon"})))),Oe.a.createElement("div",{className:"StickerProductsGift__footerButtons"},Oe.a.createElement(Mt,{className:"StickerProductsGift__gift",appearance:_?"primary":"secondary",size:"m",loading:l||E,disabled:!_,price:null==f?void 0:f.price,text:_?Object(K.langStr)(Yt("purchases_stickers_gift_send_for"),"price",Yt("global_n_votes",null==f?void 0:f.price.current)):Yt("purchases_stickers_gift_send"),onClick:function(){return C()}})))))},$t=function(){return($t=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function Xt(e,t){var i;if(he().productsGiftLock)return null;ve({productsGiftLock:!0});var r=$t({},t);function n(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductsGift")}function o(){null==i||i.hide()}function s(){null==i||i.updateBoxCoords()}return Ke(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=e[0];e[1];Ge(),(i=new D.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=n();t&&Pe.a.render(Oe.a.createElement(qt,{cart:e,options:r,closeBox:o,updateBox:s}),t)}(t),requestAnimationFrame((function(){s()}))},onHideAttempt:function(){var e;return(e=n())&&Pe.a.unmountComponentAtNode(e),!0},onHide:function(){ve({productsGiftLock:!1})}})).content('<div class="StickersProductsGift"></div>'),i.show()}),(function(){})),{hide:o}}function Jt(e,t,i){return void 0===t&&(t=[]),Xt(Be.create(e,t),i)}var Qt=Ae.default.getLang;var Zt=function(e){var t=e.pack,i=e.cart,r=e.options,n=r.recipientIds,o=void 0===n?[]:n,s=r.ref,a=r.gift_ref,c=e.closeBox,l=qe(t.id)[0];l&&(t=l);var d=Xe(t.style_ids||[]),u=d[0],f=d[1],_=Qe((function(){return i})),m=_[0],p=_[1],h=function(e){var t=$e(e.map((function(e){return e.product_id}))),i=t[0],r=t[1];return[Object(Ie.useMemo)((function(){return e.map((function(e,t){return Je(Je({},e),{product:i[t]})}))}),[e]),r]}(m.getItems())[0],v=m.getProducts(),g=m.getOrder(),k=ke(t.sticker_ids[0]),S=function(e){if(!e)return null;for(var t=[],i=[],r=0,n=e.items;r<n.length;r++){var o=n[r],s=o.product,a=o.error;s&&!a&&(X(s)?t.push(o):$(s)&&i.push(o))}var c=i.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);if(t.length){var l=t.reduce((function(e,t){var i;return e+((null===(i=t.price)||void 0===i?void 0:i.current)||0)}),0);return l?i.length?c?Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_for_styles_for",i.length),"pack_price",Qt("global_n_votes",l),"styles_num",i.length,"styles_price_sum",c):Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_for_styles_free",i.length),"pack_price",Qt("global_n_votes",l),"styles_num",i.length):Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_for"),"pack_price",Qt("global_n_votes",l)):i.length?c?Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_free_styles_for",i.length),"styles_num",i.length,"styles_price_sum",Qt("global_n_votes",c)):Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_free_styles_free",i.length),"styles_num",i.length):Object(K.langStr)(Qt("purchases_stickers_order_summary_pack_free"))}if(i.length)return c?Object(K.langStr)(Qt("purchases_stickers_order_summary_styles_for",i.length),"styles_num",i.length,"styles_price_sum",Qt("global_n_votes",c)):Object(K.langStr)(Qt("purchases_stickers_order_summary_styles_free",i.length),"styles_num",i.length);return null}(g),w=!p&&g&&!g.error,b=Object(Ie.useState)(!1),y=b[0],j=b[1],E=null;if(g)if(g.error){if(g.error===Z.NOT_SIGNED_IN){E=Oe.a.createElement(Ue.default,{className:"StickerPackPreview__purchase",size:"m",loading:p,onClick:function(){Object(He.showDoneBox)(Qt("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},Qt("purchases_stickers_get_pack_btn"))}else if(g.error===Z.NO_VALID_ITEMS){if(1===g.items.length){var T=g.items[0],C=T.product,I=T.error;if(C&&I!==ee.DUPLICATE_PRODUCT&&C.purchase_details){var O=C.purchase_details,R=O.label,P=O.title,N=O.text,L=O.button_title,x=O.button_url;E=Oe.a.createElement(Ue.default,{className:"StickerPackPreview__purchase",size:"m",appearance:"primary",loading:p,onClick:function(){Object(D.showFastBox)(P||Qt("purchases_stickers_catalog_purchase_details_title"),N,x&&L||null,x?function(){window.location.href=x}:null)}},R||Qt("purchases_stickers_product_unavailable"))}}if(!E){var B=!g.items.find((function(e){return e.error!==ee.DUPLICATE_PRODUCT}));E=Oe.a.createElement(Ue.default,{className:"StickerPackPreview__purchase",size:"m",appearance:"secondary",loading:p,disabled:!0},Qt(B?"purchases_stickers_product_purchased":"purchases_stickers_product_unavailable"))}}}else{var A=p||y;E=Oe.a.createElement(Mt,{className:"StickerPackPreview__purchase",size:"m",loading:A,disabled:A,price:g.price,text:g.price.current?Qt("purchases_stickers_buy_for"):Qt("purchases_stickers_get_for_free"),onClick:function(){y||(j(!0),m.order({ref:s,gift_ref:a}).then((function(e){j(!1),e&&!e.error&&Object(He.showDoneBox)(ze(e))}),(function(){})))}})}var H=!p&&void 0!==v.find((function(e){return null==e?void 0:e.can_gift})),M=h.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set);return Oe.a.createElement("article",{className:"StickerPackPreview"},Oe.a.createElement("header",{className:"StickerPackPreview__header"},Oe.a.createElement("a",{className:"StickerPackPreview__close",onClick:c}),k&&Oe.a.createElement(vt,{className:"StickerPackPreview__icon",sticker:k,width:128,height:128}),Oe.a.createElement("div",{className:"StickerPackPreview__info"},Oe.a.createElement(We.default,{element:"h1",className:"StickerPackPreview__title"},t.title),Oe.a.createElement(We.default,{element:"div",className:"StickerPackPreview__author"},t.author),Oe.a.createElement(We.default,{element:"div",className:"StickerPackPreview__description"},t.description))),u.length>0&&Oe.a.createElement(Rt,{className:"StickerPackPreview__styles",styles:u,isLoading:f,isAdded:function(e){return m.hasProduct(e.id)},add:function(e){return m.addProduct(e.id)},remove:function(e){return m.removeProduct(e.id)},gift:function(e){Jt([e.id],o)}}),Oe.a.createElement("div",{className:"StickerPackPreview__footerContainer"},Oe.a.createElement("section",{className:"StickerPackPreview__items"},h.map((function(e){return Oe.a.createElement(Lt,{item:e,showHeader:u.length>0,remove:e.product&&$(e.product)?function(){return m.removeProduct(e.product_id)}:void 0,key:e.product_id})}))),M.size>0&&Oe.a.createElement("section",{className:"StickerPackPreview__copyrights"},Array.from(M).map((function(e,t){return Oe.a.createElement("div",{key:t,className:"StickerPackPreview__copyright"},e)}))),Oe.a.createElement("footer",{className:"StickerPackPreview__footer"},!p&&(w||H)&&Oe.a.createElement("div",{className:"StickerPackPreview__footerNote"},S),Oe.a.createElement("div",{className:"StickerPackPreview__footerButtons"},H&&Oe.a.createElement(Ve.default,{className:"StickerPackPreview__gift",appearance:"primary",size:"m",onClick:function(){return(e=m.copy()).setRecipientIds(o),void Xt(e);var e}},Qt("purchases_stickers_gift")),E))))},ei=function(){return(ei=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ti=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)r[n]=o[s];return r},ii=Ae.default.getLang,ri=function(e){var t=e.pack,i=e.options,r=e.closeBox,n=e.updateBox,o=qe(t.id),s=o[0],a=o[1];s&&(t=s);var c=Xe(t.style_ids||[]),l=c[0],d=c[1],u=a||d;Object(Ie.useEffect)((function(){n()}),[u]);var f=ei(ei({},t),{base_id:t.id,title:ii("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),_=ti([f],l),m=_.find((function(e){return e&&e.is_active}))||f,p=Object(Ie.useState)(),h=p[0],v=p[1],g=h&&_.find((function(e){return e&&e.id===h})),k=function(e){v(e&&e.id)},S=g||m,w=S===f?ii("purchases_stickers_product_preview_title_base_pack"):Object(K.langStr)(ii("purchases_stickers_product_preview_title_style"),"title",S.title);Object(Ie.useEffect)((function(){S.is_new&&Ce(S.id,W.IsNew,0).finally((function(){}))}),[S,S.is_new]);var b=Object(Ie.useState)(!1),y=b[0],j=b[1],E=Object(Ie.useState)(!1),T=E[0],C=E[1],I=function(e){T||(C(!0),function(e){return new Promise((function(t){_e.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){be(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))}(e).then((function(){C(!1),k(void 0)}),(function(){})))};return Oe.a.createElement("article",{className:"StickerPackSettings"},Oe.a.createElement(Dt.ModalHeader,{className:"StickerPackSettings__header",title:t?Object(K.langStr)(ii("purchases_stickers_style_selection_for_pack"),"title",t.title):"",appearance:"blue",onClose:r}),u?Oe.a.createElement("section",{className:"StickerPackSettings__content StickerPackSettings__content--loading"},Oe.a.createElement(Ft.default,{size:24})):Oe.a.createElement(Oe.a.Fragment,null,_.length>0&&Oe.a.createElement(Rt,{className:"StickerPackSettings__styles",styles:_,isLoading:d,activeStyle:m,selectedStyle:S,select:function(e){return k(e)}}),Oe.a.createElement("div",{className:"StickerPackSettings__footerContainer"},Oe.a.createElement("section",{className:"StickerPackSettings__stylePreview"},Oe.a.createElement(We.default,{element:"h2",className:"StickerPackSettings__stylePreviewTitle"},w),Oe.a.createElement(Pt,{product:S})),Oe.a.createElement("footer",{className:"StickerPackSettings__footer"},Oe.a.createElement("div",{className:"StickerPackSettings__footerButtons"},S.can_gift&&Oe.a.createElement(Ve.default,{className:"StickerPackSettings__gift",appearance:"secondary",size:"m",onClick:function(){Jt([S.id],i.recipientIds||[])}}),S.is_purchased?Oe.a.createElement(Ue.default,{className:"StickerPackSettings__activate",appearance:"primary",size:"m",disabled:S===m,loading:T,onClick:function(){return I(S)}},ii("purchases_stickers_product_settings_save")):Oe.a.createElement(Mt,{className:"StickerPackSettings__buy",appearance:"primary",size:"m",price:S.price.purchase,text:ii(S.price.purchase.current?"purchases_stickers_buy_for":"purchases_stickers_get_for_free"),loading:y,onClick:function(){return e=S,void(y||(j(!0),Be.create([e.id]).order().then((function(){j(!1)}),(function(){}))));var e}}))))))},ni=Ae.default.getLang,oi=function(e){var t=e.style,i=e.options.add,r=e.closeBox;return Oe.a.createElement("article",{className:"StickerStylePreview"},Oe.a.createElement(Dt.ModalHeader,{className:"StickerStylePreview__header",title:Object(K.langStr)(ni("purchases_stickers_stickers_of_style"),"title",t.title),onClose:r}),Oe.a.createElement(Pt,{className:"StickerStylePreview__content",product:t}),Oe.a.createElement("footer",{className:"StickerStylePreview__footer"},Oe.a.createElement(Ve.default,{className:"StickerStylePreview__cancel",appearance:"tertiary",size:"m",onClick:r},ni("global_cancel")),i&&Oe.a.createElement(Ve.default,{className:"StickerStylePreview__add",appearance:"primary",size:"m",onClick:function(){return i(t)}},ni("purchases_stickers_preview_add_item"))))},si=function(){return(si=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ai=new Map;function ci(e,t){Ke(),function(e){var t=Se(e);return t?Promise.resolve(t):new Promise((function(t){_e.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(i){be(i),t(Se(e))},onFail:function(e){return console.error(e),t(null),!0}})}))}(e).then((function(e){e?li(e.id,t):Ge()}),(function(){}))}function li(e,t){var i,r=si({},t);function n(){return null==i?void 0:i.bodyNode.querySelector(".StickersProductPreviewBox")}function o(){null==i||i.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function s(){null==i||i.updateBoxCoords()}Ke();var a=Be.create([e]);return Promise.all([a.load(),window.stManager.add(["stickers.css"])]).then((function(t){var a=t[0];t[1];Ge();var c=ye(e);c&&!c.is_disabled?((i=new D.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){!function e(t,i){var a=null,c=null;if(X(t))a=t.is_purchased&&(null==r?void 0:r.settings)?Oe.a.createElement(ri,{pack:t,options:r,closeBox:o,updateBox:s}):Oe.a.createElement(Zt,{pack:t,cart:i,options:r,closeBox:o,updateBox:s}),c=t.name;else if($(t)){var l=ye(t.base_id);if(l)return i.addProduct(l.id,!0),void e(l,i);a=Oe.a.createElement(oi,{style:t,options:r,closeBox:o,updateBox:s}),c=t.name}var d=n();if(d&&a&&(Pe.a.render(a,d),c)){var u=window.nav.objLoc[0].split("/");"stickers"===u[0]&&u[1]!==c&&window.nav.setLoc({0:"stickers/"+c})}}(c,a),requestAnimationFrame((function(){s(),function(){if(ai.has(e)){var t=Fe();t&&(t.scrollTop=ai.get(e)||0),ai.delete(e)}}()}))},onBeforeHide:function(){!function(){var t=Fe();t&&ai.set(e,t.scrollTop)}()},onHideAttempt:function(){var e;return(e=n())&&Pe.a.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),i.show()):Object(D.showFastBox)(Object(K.getLang)("global_box_error_title"),Object(K.getLang)("purchases_stickers_product_not_found"))}),(function(){})),{hide:o}}function di(){return(di=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function ui(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_i(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,n=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function fi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],r=!0,n=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw o}}return i}(e,t)||_i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _i(e,t){if(e){if("string"==typeof e)return mi(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?mi(e,t):void 0}}function mi(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function pi(){return Object(l.partConfigEnabled)("stickers_web_new_ui")}var hi={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},DELETE_FAV_STICKER_ELEMENTS_DELAY:500,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),init:function(e,t){var i=hi.last;hi.tabDefaultId=hi.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=gpeByClass("_emoji_field_wrap",e),t.emojiWrap=domByClass(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=domByClass(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&Object(u.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=vkNow(),t.deletedFavoriteStickers=[],t.deleteFavoriteStickersTimeout=null,t.suggestions=new A(t.suggestionsConfig);var r=Object(d.isRetina)()?128:64;if(hi.stickerSizes[r]=!0,t.forceTxt)t.editable=0,placeholderInit(e);else{if(t.editable=1,setTimeout((function(){placeholderInit(e,{editable:1,editableFocus:hi.editableFocus,global:t.global}),t.shouldFocus&&hi.editableFocus(e,!1,!0)}),0),browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}addEvent(window,"mousemove",hi.preventMouseOverHandle),addEvent(e,browser.opera&&!browser.chrome?"click":"mousedown",(function(r){if(r.target&&"IMG"==r.target.tagName&&hi.getCode(r.target))return hi.editableFocus(e,r.target,r.offsetX>8),cancelEvent(r);hi.shown&&hi.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&addEvent(e,"blur",(function(t){e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)}))})),addEvent(e,"keypress keydown keyup input paste",(function(r){if(r.canceled)return!1;if("keydown"===r.type){t.onChange&&(hi.raw[i]=e.innerHTML);var n=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(r.keyCode==KEY.RETURN||10==r.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),cancelEvent(r);var o=cur.ctrl_submit&&!t.noCtrlSend;if((o||n)&&(r.ctrlKey||browser.mac&&r.metaKey)||!o&&!r.shiftKey&&!(r.ctrlKey||browser.mac&&r.metaKey)){var s=Object(u.data)(e,"composer");if(!hi.emojiEnter(i,r)||!hi.stickerHintMove(r)||s&&s.wdd&&isVisible(s.wdd.listWrap))return!1;if(!n||r.ctrlKey||browser.mac&&r.metaKey)return hi.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),cancelEvent(r)}if(t.noLineBreaks)return cancelEvent(r)}if(r.ctrlKey&&r.keyCode==KEY.RETURN){var a=this.value;if(t.editable)hi.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var c=this.selectionStart;this.value=a.slice(0,c)+"\n"+a.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=c+1}else if(document.selection&&document.selection.createRange){this.focus();var d=document.selection.createRange();d.text="\r\n",d.collapse(!1),browser.opera&&!browser.chrome&&(d.moveEnd("character",0),d.moveStart("character",0)),d.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var f=Object(H.hasAccessibilityMode)()&&Object(l.partConfigEnabled)("emoji_tooltip_a11y_mode");if(r.keyCode===KEY.TAB&&!(r.ctrlKey||browser.mac&&r.metaKey)&&!f){var _=geByClass1("_sticker_hints",domPN(t.txt));if(_&&isVisible(_)){var m=geByClass1("over",_);if(m?hi.stickerHintKeyOut(i,m):hi.stickerHintKeyOver(i,geByClass1("emoji_sticker_item",_)),!hi.shown)return cancelEvent(r)}return hi.shown?(hi.editableFocus(e,!1,!0,void 0,!0),hi.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)):hi.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!1,!0,void 0,!0),cancelEvent(r)}if(r.keyCode==KEY.ESC){var p=geByClass1("_sticker_hints",domPN(t.txt)),h=!1;if(p&&isVisible(p)&&(hi.stickerHintKeyOut(i,geByClass1("emoji_sticker_item",p)),hi.stickersHintsHide(p,t,100),h=!0),hi.shown&&(hi.editableFocus(e,!1,!0,void 0,!0),hi.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),h=!0),h)return cancelEvent(r);if(t.onEsc)return t.onEsc(r)}}return"paste"===r.type?(hi.onEditablePaste(e,t,i,r),t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),hi.checkStickersKeywords(i,t)):"keyup"===r.type?(!t.noLineBreaks||e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)})),t.checkEditable&&t.checkEditable(i,e),hi.checkStickersKeywords(i,t),t.onChange&&(hi.raw[i]!=e.innerHTML&&hi.onChange(t),delete hi.raw[i])):"keydown"!==r.type&&"input"!==r.type||(t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),hi.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(r),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(r),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,hi.lcRecv,!0),hi.initStickersKeywords(),hi.initPromotedStickerUrls(),hi.checkNewStickers(t),hi.opts[hi.last]=t,hi.last++},setSuggestionsConfig:function(e,t){hi.opts[e].suggestions.setConfig(t)},onChange:function(e){Object(E.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){hi.preventMouseOver=!1},lcRecv:function(e){switch(e.act){case"updateTabs":hi.updateTabs(e.newStickers,e.keywords)}},correctCaret:function(e){var t=e?function(e){var t=e.getBoundingClientRect(),i=null,r=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(r=document.selection.createRange()).getClientRects()||[]).length||(r.text="_",r.moveStart("character",-1),i=r.getClientRects(),r.text=""),i=i[i.length-1];else if(window.getSelection){var n=getSelection();if(n.anchorNode){if((r=n.getRangeAt(0)).collapsed){var o=r.startOffset;r.setStart(r.startContainer,0),i=r.getClientRects(),r.setStart(r.startContainer,o)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),r=ce("div",{innerHTML:i});hi.cleanCont(r),hi.insertHTML(r.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),r=ce("div",{innerHTML:i});hi.cleanCont(r),hi.insertHTML(r.innerHTML)}},focusTrick:function(e,t,i,r,n){n||(n=e);var o=ce("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(o),o.focus(),setTimeout((function(){var s=n.scrollTop;re(o),e.focus(),n.scrollTop=s,hi.setRange(r),t(clean(val(o))),i(e)}),0)},finalizeInsert:function(e){hi.cleanCont(e),setTimeout(hi.correctCaret.pbind(e),10)},getClipboard:function(e){return e.clipboardData?clean(e.clipboardData.getData("text")):!!window.clipboardData&&clean(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,r){if(null!=e.clipboardData){var n=function(){var n=e.clipboardData;function o(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var n=new Image;return n.crossOrigin="anonymous",n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var r,n;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+irand(0,100)+".png",hasClass(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else r="post_field"==t.id?cur.wallAddMedia:(n=Object(u.data)(t,"composer"))&&n.addMedia;r&&Object(E.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,r,e)}(e)}),"image/png"),r(!0)},n.src=e}}if(n.items){for(var s=!1,a=0,c=n.items.length;a<c;a++){var l=n.items[a];if(l.type.match(/^image\//)){var d=new FileReader;d.onload=function(e){return o(e.target.result)},d.readAsDataURL(l.getAsFile()),s=!0}else if("text/plain"===l.type)return{v:r()}}return{v:s}}if(-1!==Array.prototype.indexOf.call(n.types,"text/plain"))return{v:r()};!function(e){for(var i=Math.floor(1e3*Math.random()),n=geByTag("img",t),o=0,s=n.length;o<s;o++){n[o]["_before_paste_"+i]=!0}setTimeout((function(){for(var n=geByTag("img",t),o=!1,s=0,a=n.length;s<a;s++){var c=n[s];c["_before_paste_"+i]||(e(c.src),re(c),o=!0)}o||r()}),1)}((function(e){return o(e)}))}();if("object"==typeof n)return n.v}else r()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,r,n){var o=!1;"true"===e.getAttribute("contenteditable")&&(o=hi.getRange());var s=this.getClipboard(r),a=s&&o&&!n;this.detectInvalidClipboardData(r)&&cancelEvent(r),(this.processImagePaste(r,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(o,s):this.insertWithBr(o,s),setTimeout(this.finalizeInsert.bind(this,e),0)):o&&this.focusTrick(e,t.noLineBreaks?this.insertWithoutNL.pbind(o):this.insertWithBr.pbind(o),this.finalizeInsert.bind(this,e),o))}.bind(this))||a)&&cancelEvent(r),hi.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",hi.cleanCont(t);else if("IMG"==t.tagName)hi.getCode(t)||re(t);else if("BR"!=t.tagName){var n=hi.editableVal(t,{saveEmoji:!0}),s=cf(clean(n).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(s,t)}break;case 3:var a=clean(t.textContent||t.innerText),c=Object(r.emojiRegex)();a&&a.match(c)&&(a=a.replace(c,o.emojiReplace),t.parentNode.replaceChild(cf(a),t))}t=i}},focus:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];hi.editableFocus(e,!1,!0);var r=i||e.parentNode;if(t){var n=getXY(r)[1],o=scrollGetY(),s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=getSize(r)[1];o+s<n+a?scrollToY(n-s+a+60,100):o>n&&scrollToY(n-60,100)}},destroy:function(e){if(hi.opts.hasOwnProperty(e)){var t=hi.opts[e];t.txt&&t.txt.blur(),t.imagesLoader&&t.imagesLoader.destroy(),e===hi.shownId&&(hi.shownId=!1,hi.shown=!1),delete hi.opts[e]}},editableFocus:function(e,t,i,r,n){if(!e||n&&document.activeElement===e)return!1;if((e=ge(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var o=window.getSelection();if(!browser.opera||browser.chrome||i){var s=document.createRange();t?s.selectNode(t):s.selectNodeContents(e),browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),r||s.collapse(!i),(o=window.getSelection()).removeAllRanges(),o.addRange(s)}else o.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t||e),a.collapse(!i),a.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return hi.editableVal(e);t=(t=Object(o.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,hi.updateStickersHints();var i=Object(u.data)(e,"composer");return i&&window.Composer&&setTimeout(Composer.updateAutoComplete.pbind(i)),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return val(e);for(var i,r=e.firstChild,n="",o=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");r;){switch(r.nodeType){case 3:n+=i=r.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=hi.editableVal(r),r.tagName&&r.tagName.match(o)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var s=r.previousSibling;s&&3==s.nodeType&&""==trim(s.nodeValue);)s=s.previousSibling;!s||s.tagName&&(s.tagName.match(o)||"BR"==s.tagName)||(i="\n"+i)}else if("IMG"==r.tagName){var a=hi.getCode(r);a&&(t&&t.saveEmoji?i+=hi.getEmojiHTML(a):i+=hi.codeToChr(a))}else"BR"==r.tagName&&(i+="\n");n+=i}r=r.nextSibling}return n},cssEmoji:r.EMOJI_HINTS,getEmojiHTML:o.getEmojiHTML,codeToChr:n.emojiByteHexToSymbol,checkEditable:function(e,t,i){var r=t.scrollHeight,n=hi.opts[e];if(!n)return!1;n.scPaddings||(n.scPaddings=intval(getStyle(t,"paddingTop"))+intval(getStyle(t,"paddingBottom"))),r-=n.scPaddings;var o=n.tt;if(r>i.height+(browser.mozilla&&n.isChat?0:5)){if(!n.isSized){setStyle(t,{height:i.height+"px",overflowY:"auto"});var s=geByClass1("emoji_smile",n.controlsCont),a=geByClass1("emoji_smile_icon_promo",n.controlsCont),c=ge("im_upload"),l=Object(M.sbWidth)();n.ttWrap&&(l+=getSize(n.ttWrap)[0]-(getXY(n.emojiBtn)[0]-getXY(n.ttWrap)[0])),setStyle(s,vk.rtl?{left:1+l}:{right:1+l}),a&&setStyle(a,vk.rtl?{left:2+l}:{right:2+l}),c&&setStyle(c.parentNode,vk.rtl?{left:1+l}:{right:1+l}),o&&setStyle(o,vk.rtl?{left:(n.ttDiff||31)+l}:{right:(n.ttDiff||31)+l}),n.isSized=!0}}else if(n.isSized){setStyle(t,{height:"auto",overflowY:"hidden"});var d=geByClass1("emoji_smile",n.controlsCont),u=geByClass1("emoji_smile_icon_promo",n.controlsCont),f=ge("im_upload");setStyle(d,vk.rtl?{left:1}:{right:1}),u&&setStyle(u,vk.rtl?{left:2}:{right:2}),f&&setStyle(f.parentNode,vk.rtl?{left:1}:{right:1}),o&&setStyle(o,vk.rtl?{left:n.ttDiff||31}:{right:n.ttDiff||31}),n.isSized=!1}n.onResize&&n.onResize()},stickersHintsShow:function(e,t,i){(isVisible(e)||fadeIn(e,i),t.stickerEventsInited)||((e&&geByClass1("_sticker_hints_inner",e)).addEventListener("wheel",hi.onWheelStickersHints),addEvent(document,"keydown",hi.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},addEvent(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&(removeEvent(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(r){if(t.hintsClicked)return cancelEvent(r),!0;hi.stickersHintsHide(e,t,i)},addEvent(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);hi.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){(fadeOut(e,i),removeEvent(document,"keydown",hi.stickerHintMove),t.onHintsMouseDown&&removeEvent(e,"mousedown",hi.onHintsMouseDown),t.onHintsWheel)&&(e&&geByClass1("_sticker_hints_inner",e)).removeEventListener("wheel",hi.onWheelStickersHints);t.txt&&(t.onTxtBlur&&(removeEvent(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&removeEvent(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&geByClass1("_sticker_hints",domPN(t.txt));e&&!isVisible(e)&&(delete t.stickerHintsString,hi.checkStickersKeywords(t.id,t,!1))},addEvent(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete hi.shownHintId,hi.sendHintsLog()},stickerHintOver:function(e){hi.stickerHintOut(e),addClass(e,"over")},stickerHintOut:function(e){each(geByClass("over",domPN(e)),(function(){removeClass(this,"over")}))},stickerHintClick:function(e,t,i,r){var n=hi.opts[e]||{},o=n.txt,s=o&&geByClass1("_sticker_hints",domPN(o)),a="suggestion_"+hi.stickerSuggestionQuery;return"stories"===n.ref&&(a="story_suggestion_"+hi.stickerSuggestionQuery),t<0?hi.previewSticker(!1,r,{stickerId:-t,sticker_referrer:a}):(val(o,""),hi.stickerClick(e,t,256,i,r,a),n.checkEditable&&n.checkEditable(e,o)),hi.stickersHintsHide(s,n,0),!1},stickerHintKeyOver:function(e,t){hi.stickerHintOver(t),hi.shownHintId=e},stickerHintKeyOut:function(e,t){hi.stickerHintOut(t),delete hi.shownHintId},stickerHintMove:function(e){var t=hi.shownHintId;if(void 0===t)return!0;var i=hi.opts[t],r=i&&geByClass1("_sticker_hints",domPN(i.txt));if(r&&isVisible(r)){var n=geByClass1("over",r)||geByClass1("emoji_sticker_item",r);switch(e.keyCode){case KEY.LEFT:return(n=domPS(n))&&(hi.stickerHintOver(n),hi.checkStickersHintsScroll(n)),cancelEvent(e),!1;case KEY.RIGHT:return(n=domNS(n))&&(hi.stickerHintOver(n),hi.checkStickersHintsScroll(n)),cancelEvent(e),!1;case KEY.ENTER:return n.click(),cancelEvent(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&(addClass(e,"_margin_transition"),Object(u.removeClassDelayed)(e,"_margin_transition")),setStyle(e,{marginLeft:0});var r=getXY(e),n=getSize(e),o=hi.getEmojiTtXY(t.tt);t.tt&&o&&o[0]&&r[0]+n[0]+10>o[0]&&r[1]+n[1]>o[1]&&setStyle(e,{marginLeft:o[0]-r[0]-n[0]-10}),domFC(e)||hi.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&hasClass(e,hi.SHOWN_TT_CLS)?getXY(e):[0,0]},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,i){if(Object(l.partConfigEnabled)("hintach"))return hi.hintachCache[e]?requestAnimationFrame(()=>hi.renderHintach(e,t,i,hi.hintachCache[e])):void ajax.post("/hintach",{query:e},{onDone:r=>{hi.hintachCache[e]=r,hi.renderHintach(e,t,i,hi.hintachCache[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var r=hi.opts[i]||{},n=r.txt,o=n&&geByClass1("_sticker_hints",domPN(n)),s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],r=parseInt(t[2]),n=parseInt(t[3]),o=[r,n].join("_");return{type:i,ownerId:r,id:n,rawId:o}}(t);return s&&r.onHintachSend&&(val(n,""),r.onHintachSend(s.type,s.rawId),r.checkEditable&&r.checkEditable(i,n),hi.stickersHintsHide(o,r,0)),!1}},renderHintach:function(e,t,i,r){var n=t.txt,o=geByClass1("_sticker_hints",domPN(n)),s=isArray(r.photos)&&r.photos.length||isArray(r.docs)&&r.docs.length;if(e&&t.stickerHintsString&&s){var a=o&&geByClass1("_sticker_hints_inner",o);if(!a||t.noStickers)return!1;hi.clearHintsLog(),hi.hintachNotFoundStickers[e]&&(a.innerHTML="");var l=a.querySelector(".Hintach");l||(l=a.appendChild(ce("div",{className:"Hintach"}))),l.setAttribute("data-opt",t.id),l.innerHTML="";var d=64*window.devicePixelRatio,u=64*window.devicePixelRatio;(r.photos||[]).forEach(e=>{var t=function(e,t,i){if(!e||!t||!i)return null;var r=Object.values(e).sort((e,t)=>e[1]-t[1]||e[2]-t[2]);return r.find(e=>e[1]>=t&&e[2]>=i)||r[parseInt(r.length/2)]||r[0]}(e.sizes,d,u);if(t){var i=fi(t,3),r=i[0],n=fi(c(i[1],i[2]),2),o=n[0],s=n[1],a=ce("div",{className:"Hintach__item Hintach__item--photo"});a.setAttribute("data-hint","photo"+e.id),a.appendChild(ce("div",{className:"Hintach__itemThumb"},{width:o,height:s,backgroundImage:`url(${r})`})),a.onclick=hi.onHintachItemClick,l.appendChild(a)}}),(r.docs||[]).forEach(e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=fi(e.preview.video||e.preview.graffiti,3),i=t[0],r=fi(c(t[1],t[2]),2),n=r[0],o=r[1],s=ce("div",{className:"Hintach__item Hintach__item--doc"});s.setAttribute("data-hint","doc"+e.id);var a=s.appendChild(ce(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:n,height:o}));e.preview.video&&(s.appendChild(ce("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),s.onclick=hi.onHintachItemClick,l.appendChild(s)}}),l.childElementCount>0&&(hi.stickersHintsShow(o,t,100),a.scrollLeft=0,hi.checkStickersHintsScroll(o,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var r=hi.opts[e],n=r.txt.parentNode.querySelector("._sticker_hints");if(hi.stickersHintsHide(n,r,0),"send"===t&&r.suggestions.isMoneySendEnabled()||"request"===t&&r.suggestions.isMoneyRequestEnabled()){var o=r.suggestions.config,s=o.fromId,a=o.peer;j.onClick(s,a,t,i,{onSendStart:()=>{r.clearText&&r.clearText()}});var c=hi.moneyTransferTextMatch&&hi.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","select",[t],c)}},renderMoneyTransferSuggestions:function(e,t){var i=hi.opts[e],r=Object(d.isRetina)()?128:64,n={};return i.suggestions.isMoneyRequestEnabled()?n.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${r}.png" />\n      </a>`:n.request="",i.suggestions.isMoneySendEnabled()?n.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${r}.png" />\n      </a>`:n.send="",t.request?n.request+n.send:n.send+n.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var r=i?0:100,n=t.txt,o=geByClass1("_sticker_hints",domPN(n)),s=function(i,r){if(hi.stickers[hi.TAB_RECENT_STICKERS]){var n=hi.sortStickersHints(window.stickersKeywords[i]),s=hi.stickers[hi.TAB_RECENT_STICKERS].promoted,a="";r&&(a+=hi.renderMoneyTransferSuggestions(e,r)),each(n,(function(){a+=hi.render.stickerHintRs(e,this,s[this])})),t.suggestions.isBotLinkEnabled()&&(a+=hi.renderSuggestionsBotLink(e)),hi.showStickersHints(o,t,a)}},a=function(){var a=t.suggestions.getQueries(hi.val(n));if(a.length){var c=a[0],l=t.suggestions.isMoneyTransferEnabled()&&j.match(c,1);if(l&&(a=[j.DEFAULT_QUERY]),hi.moneyTransferTextMatch=l,!o&&!(o=hi.initStickersHints(n)))return!1;if(c!=t.stickerHintsString){var d=a.find(e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length);if(hi.stickerSuggestionQuery=d,d)if(hi.stickers[hi.TAB_RECENT_STICKERS])s(d,l);else{var u=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){u&&u(),e&&(u?t.onRecentEmojiUpdate=u:delete t.onRecentEmojiUpdate,s(d,l))},hi.emojiLoadMore(e)}else hi.hintachNotFoundStickers[c]=!0,hi.stickersHintsHide(o,t,r);!l&&c&&c.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout(()=>{hi.checkHintach(c,t,i)},160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,o&&isVisible(o)?0:200))},showStickersHints:function(e,t,i){var r=e&&geByClass1("_sticker_hints_inner",e);if(!r||t.noStickers)return!1;hi.clearHintsLog(),val(r,i),hi.stickersHintsShow(e,t,100),r.scrollLeft=0,hi.checkStickersHintsScroll(e,r.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=domClosest("_sticker_hints",e),r=i&&geByClass1("_sticker_hints_inner",i),n=i&&geByClass1("_sticker_left",i),o=i&&geByClass1("_sticker_right",i);if(!r)return!1;var s=getSize(n)[0],a=getSize(o)[0];if(hasClass(e,"emoji_sticker_item")){var c=e.offsetLeft-8-s,l=e.offsetLeft+getSize(e)[1]+2+a-r.clientWidth;r.scrollLeft>c&&(r.scrollLeft=c),r.scrollLeft<l&&(r.scrollLeft=l),t=r.scrollLeft}var d=t>0,u=t+r.clientWidth<r.scrollWidth;toggle(n,d),toggleClass(i,"sticker_hints_left_pad",d),toggle(o,u),toggleClass(i,"sticker_hints_right_pad",u),t=void 0===t?r.scrollLeft:t;var f=r.querySelectorAll(".emoji_sticker_item"),_=d?s+8:0,m=u?a+2:0,p=Array.from(f).filter(e=>e.offsetLeft-_>=t&&e.offsetLeft+e.offsetWidth+m-r.clientWidth<=t);hi.logHints(p.map(e=>intval(e.getAttribute("data-sticker-id"))).filter(e=>e));var h=p.map(e=>e.getAttribute("data-money-transfer-type")).filter(e=>e);if(h.length){var v=hi.moneyTransferTextMatch&&hi.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","show",h,v)}},logHints:function(e){hi.logHintsTimeout&&clearTimeout(hi.logHintsTimeout),hi.logHintsTimeout=setTimeout(()=>{hi.hintsLogBuffer=e.reduce((e,t)=>(e[t]=1,e),hi.hintsLogBuffer||{})},hi.logHintsDelay)},clearHintsLog:function(){hi.logHintsTimeout&&clearTimeout(hi.logHintsTimeout),hi.hintsLogBuffer={}},sendHintsLog:function(){var e=hi.hintsLogBuffer&&Object.keys(hi.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),hi.clearHintsLog()},scrollStickersHints:function(e,t,i){var r=domClosest("_sticker_hints",e),n=r&&geByClass1("_sticker_hints_inner",r),o=r&&geByClass1("_sticker_left",r),s=r&&geByClass1("_sticker_right",r);if(!n)return!1;var a=n.scrollLeft+t*(n.clientWidth-2*getSize(e)[0]),c=geByClass("emoji_sticker_item",n);each(c,(function(e,i){return t>0&&i.offsetLeft-8-getSize(o)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-getSize(o)[0]||a,!1):t<0&&i.offsetLeft+getSize(i)[1]+2+getSize(s)[0]-n.clientWidth>a?(a=i.offsetLeft+getSize(i)[1]+2+getSize(s)[0]-n.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(n.scrollWidth-n.clientWidth,a)),animate(n,{scrollLeft:a},{duration:Math.abs(n.scrollLeft-a)+50,transition:Fx.Transitions.easeOutCubic}),hi.checkStickersHintsScroll(n,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,hi.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];hi.stickers[-1]&&(t=hi.stickers[-1].stickers);var i={},r=[];return each(t,(function(){inArray(this[0],e)&&!i[this[0]]&&(r.push(this[0]),i[this[0]]=1)})),each(e,(function(){i[this]||r.push(this)})),r},initStickersHints:function(e){return!!e&&domPN(e).insertBefore(se('<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n    </div>'),e)},updateStickersHints:function(e){hi.opts&&each(hi.opts,(function(t,i){e&&delete i.stickerHintsString,hi.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){var t=hi.opts[e].suggestions,i=Object(d.isRetina)()?128:64;return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=hi.opts[t].suggestions;statlogsValueEvent(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initStickersKeywords:function(){if(!window.stickersKeywordsData){var e=ls.get("stickers_keywords");e&&e.time&&e.time>vkNow()-hi.stickersKeywordsExpire&&(window.stickersKeywordsData=e.keywords)}window.stickersKeywordsData&&hi.setStickersKeywords(window.stickersKeywordsData)},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>vkNow()-hi.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:vkNow(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},setStickersKeywords:function(e,t){if(!e)return!1;window.stickersKeywords={};var i=ce("div"),r=[],n="";if(e.forEach((function(e){var t=e.words||[],i=e.user_stickers||[],o=e.promoted_stickers||[],s=i.concat(o.map((function(e){return-e})));t.forEach((function(e){n+="\n"+e,r.push(s)}))})),val(i,n),(n=i.textContent||i.innerText)&&n.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=r[t]})),!hi.stickers[hi.TAB_RECENT_STICKERS]){var o=ls.get("recent_stickers");o&&(hi.stickers[hi.TAB_RECENT_STICKERS]=o)}t&&(ls.set("stickers_keywords",{time:vkNow(),keywords:e}),hi.updateStickersHints(!0))},emojiEnter:function(e,t){var i=hi.opts[e],r=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(r?!(t.ctrlKey||browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var n=geByTag1("img",i.emojiOvered)||geByTag1("i",i.emojiOvered);hi.addEmoji(e,hi.getCode(n),i.emojiOvered)}return cancelEvent(t)}return!0},insertHTML:function(e){if(browser.msie&&parseInt(browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),r=document.createElement("span");i.surroundContents(r),r.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,i){if(!1===e||!1===t)return!1;var r=hi.opts[e];if(!(vkNow()-r.ttShowT<hi.CLICK_DELAY)){if(r.editable){var n=hi.getEmojiHTML(t,hi.codeToChr(t),!0),o=r.txt,s=!!window.getSelection&&window.getSelection(),a=!1;if(s&&s.rangeCount){var c=s.getRangeAt(0);a=c.commonAncestorContainer?c.commonAncestorContainer:c.parentElement?c.parentElement():c.item(0)}for(var l=a;l&&l!=o;)l=l.parentNode;var d=o.lastChild||{};browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&re(o.lastChild),l||hi.editableFocus(o,!1,!0),hi.insertHTML(n);var f=geByClass("emoji",o);for(var _ in f.push.apply(f,geByClass("emoji_css",o)),f)if(f.hasOwnProperty(_)){var m=f[_].previousSibling;if(m&&3==m.nodeType&&m.textContent&&32==m.textContent.charCodeAt(0)){var p=m.previousSibling;p&&3==p.nodeType&&p.textContent&&160==p.textContent.charCodeAt(p.textContent.length-1)&&re(m)}}o.check&&o.check(),setTimeout(hi.correctCaret.pbind(o),5),hi.onChange(r);var h=Object(u.data)(o,"composer");h&&window.Composer&&Composer.updateAutoComplete(h)}else{var v,g,k,S=r.txt,w=S.value;v=browser.iphone||browser.ipad?hi.codeToChr(t):hi.cssEmoji[t][1]+" ",null!=S.selectionStart&&null!=S.selectionEnd?(g=S.selectionEnd,S.value=w.slice(0,S.selectionStart)+v+w.slice(g),S.selectionStart=S.selectionEnd=g+v.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(S.focus(),(k=document.selection.createRange()).text=v,k.select())}r.checkEditable&&r.checkEditable(e,r.txt),hi.checkStickersKeywords(e,r),r.saveDraft&&r.saveDraft(),r.onEmojiAdded&&r.onEmojiAdded(),hi.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(browser.msie&&browser.version<10)},scrollToggleArrow:function(e,t,i,r){var n=geByClass1("emoji_tabs_"+t+"_s",i.tt);r?(e?show:hide)(n):e?fadeIn(n,200):fadeOut(n,200),i[t+"Shown"]=e},scrollTabs:function(e,t){var i=hi.opts[e];if(i){var r,n=geByClass1("emoji_tabs_wrap",i.tt),o=n.firstChild.clientWidth-n.clientWidth;if(t){if((r=2==t?n.scrollLeft:n.scrollLeft+170)>=o){r=o;var s=geByClass1("emoji_tabs_r_s",i.tt);fadeOut(s,200),i.rShown=!1,hi.scrollToggleArrow(!1,"r",i)}r&&!i.lShown&&hi.scrollToggleArrow(!0,"l",i)}t&&2!=t||((r=2==t?n.scrollLeft:Math.max(n.scrollLeft-170,0))<=0&&(r=0,hi.scrollToggleArrow(!1,"l",i)),r<o&&!i.rShown&&hi.scrollToggleArrow(!0,"r",i)),2!=t&&(i.scrollLeft=r,animate(n,{scrollLeft:r},300))}},scrollToTab:function(e,t){var i=hi.opts[t],r=i.tt,n=geByClass1("emoji_tabs_wrap",r),o=geByClass1("emoji_tab_"+e,r);if(o){var s=Object(u.data)(n,"tween");if(!s||!s.isTweening||e!=i.curTab){var a=getSize(o)[0],c=o.offsetLeft,l=getSize(n)[0],d=c-l/2+10;c+a<n.scrollLeft?n.scrollLeft=Math.max(c,n.scrollLeft-l/2):c+a-n.scrollLeft>l&&(n.scrollLeft=Math.min(c+a-n.scrollLeft,n.scrollLeft+l/2)),animate(n,{scrollLeft:d},300,(function(){hi.scrollTabs(t,2)})),hi.selectTab(t,e,o)}}},selectTab:function(e,t,i){var r=hi.opts[e],n=r.tt,o=geByClass1("emoji_tabs",n),s=geByClass1("emoji_tab_sel",o);removeClass(s,"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),r.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t)},tabsWheel:function(e,t){cancelEvent(e);var i=hi.opts[t],r=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,n=geByClass1("emoji_tabs_wrap",i.tt),o=n.scrollLeft;n.scrollLeft+=r,o!=n.scrollLeft&&hi.scrollTabs(t,2)},show:function(e,t){var i=Object(u.data)(domPN(e),"optId");void 0!==i&&hi.ttShow(i,e,t)},hide:function(e,t,i){var r=Object(u.data)(domPN(e),"optId");void 0!==r&&hi.ttHide(r,e,t,i)},ttShow:function(e,t,i){var r=hi.opts[e];clearTimeout(r.ctt),clearTimeout(r.stt),r.scrolling&&(r.afterScrollFn=!1),r.ttShown||(t?r.obj=t:t=r.obj,r.stt=setTimeout((function(){hi.ttClick(e,t,!1,!0,i)}),hi.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,r){var n=hi.opts[e];if(clearTimeout(n.stt),n.ttShown)if(n.scrolling)n.afterScrollFn=hi.ttHide.pbind(e,t,i,r);else{t=t||n.obj||geByClass1("emoji_smile",n.controlsCont);var o=function(){hi.ttClick(e,t,!0,!1,i)};r?o():(clearTimeout(n.ctt),n.ctt=setTimeout(o,hi.HIDE_TT_TIMEOUT))}},ttClick:function(e,t,i,r,n,o){var s=hi.opts[e];if(s&&!(i&&!hi.shown||r&&hi.shown)&&(t||(t=hi.shown||ge(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!s.tt&&s.sharedTT&&s.sharedTT.emojiTT&&(s.tt=s.sharedTT.emojiTT,s.emojiScroll=s.sharedTT.emojiScroll,s.allEmojiId=s.sharedTT.emojiAllId);var a,c=s.tt;if(!c){var l=ls.get("stickers_tab");l||(l=hi.TAB_EMOJI),s.curTab=cur.stickersTab=hi.TAB_EMOJI,l==hi.TAB_EMOJI||s.noStickers||(hi.stickers[hi.TAB_RECENT_STICKERS]=ls.get("recent_stickers"),s.curTab=cur.stickersTab=l);var d='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabs('+e+', 0); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabs('+e+', 1); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';d+=hi.getTabsCode([[0,1]],e),d+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',s.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(d+=hi.getTabsCode(window.emojiStickers,e));var u="",f='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',_="showTooltip(this, {text: '"+Object(K.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";s.rPointer?f+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+_+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':f+=' onmouseover="'+_+'"',d+="</span></span>",s.noStickers||(d+='<a class="fl_r emoji_shop" '+f+'><div class="emoji_sprite emoji_shop_icon">'+(hi.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(hi.hasNewStickers)+"</div>":"")+"</div></a>"),hi.showShadow()||(u+=" emoji_no_opacity"),(s.noStickers||s.hideStickersInitial)&&(u+=" emoji_no_tabs"),c=ce("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+u,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs clear_fix">'+d+"</div></div>",onmouseenter:function(t){hasClass(c,"emoji_animated")||hi.ttShow(e,!1,t)},onmouseleave:function(t){hasClass(c,"emoji_animated")||hi.ttHide(e,!1,t)}}),s.tt=c,hi.reappendEmoji(e,c),hi.emojiOver(e,geByClass1("emoji_scroll_smiles",c).firstChild),each(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){addEvent(geByClass1(this,s.tt),"DOMMouseScroll wheel",(function(t){hi.tabsWheel(t,e)}))})),s.sharedTT&&(s.sharedTT.emojiTT=c),hi.checkEmojiSlider(s)}if(clearTimeout(s.ttEmojiHide),!1!==hi.shownId&&hi.shownId!=e&&hi.ttClick(hi.shownId,geByClass1("emoji_smile",hi.opts[hi.shownId].controlsCont),!0),hi.preventMouseOver=!1,s.emojiExpanded||hi.emojiExpand(e,c),hi.shown)hi.hideTt(c),(a=geByClass1("_sticker_hints",domPN(s.txt)))&&isVisible(a)&&hi.checkStickersHintsSize(a,s,!0),hi.shown=!1,hi.shownId=!1,s.ttShown=!1,s.emojiFocused=!1,s.emojiOvered=!1,cur.onMouseClick=!1,removeEvent(document,"keydown",hi.emojiMove),removeClass(t,"emoji_smile_on"),s.onHide&&s.onHide(),hi.favorite.deleteFavoriteStickerElements(e);else{if(s.needUpdateRecentStickers&&(hi.updateRecentStickers(e),s.needUpdateRecentStickers=!1),!getXY(s.emojiBtn)[0]||!getXY(s.emojiBtn)[1])return;s.openedByTabKey=!!o,hi.showTt(c),hi.repositionEmoji(e,t,c),(a=geByClass1("_sticker_hints",domPN(s.txt)))&&isVisible(a)&&hi.checkStickersHintsSize(a,s,!0),hi.shownId=e,hi.shown=t,cur.emojiList=geByClass1("emoji_list",c),s.ttShown=!0,s.ttShowT=vkNow(),s.emojiFocused=!0,removeEvent(document,"keydown",hi.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||hasClass(i,"emoji_tt_wrap")||hasClass(i,"imw_emoji_wrap"))return!1;i=i.parentNode}hi.ttClick(e,!1,!0)},addEvent(document,"keydown",hi.emojiMove)}),0),addClass(t,"emoji_smile_on"),s.emojiScroll&&s.emojiExpanded&&(s.emojiScroll.update(),browser.msie&&0===s.curTab&&s.emojiOvered&&hi.scrollToListEl(e,s.emojiOvered)),s.currentPeerId=void 0,hi.tabSwitch(s.curTab,s.curTab,e),s.onRecentEmojiUpdate&&s.onRecentEmojiUpdate(!0),s.onShow&&s.onShow(),s.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return hi.hideStickersStoreNotification(),hi.noNewStickers=!0,s.noStickersStore?addClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):removeClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),cancelEvent(n)}},curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId(e){var t=hi.opts[e];if(window.curFastChat){var i=window.curFastChat.activeBox;if(i&&i.content&&i.content.compareDocumentPosition(t.emojiBtn)&Node.DOCUMENT_POSITION_CONTAINED_BY)return window.curFastChat.peer}return cur.peer},getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!Object(z.isUserPeer)(e))return Promise.resolve(null);var t=new Promise((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}}));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=hi.opts[e];if(!r.emojiMoreSt){r.emojiMoreSt=1,t.act="get_emoji_list",hi.stickerPacksToLoad&&(t.sticker_packs_to_load=hi.stickerPacksToLoad.join(",")),hi.hasNewStickers<0&&(t.new_shown=1);var n=Object.assign(t.sizes||{},hi.stickerSizes);t.sizes=n&&Object.keys(n).join(","),ajax.post("al_im.php",t,{onDone:function(t,o,s,a,c,l){if(hi.buildStickersIndex(t),void 0!==t[hi.TAB_FAVORITE_STICKERS]){var d=t[hi.TAB_FAVORITE_STICKERS];hi.tabDefaultId=hi.TAB_FAVORITE_STICKERS,hi.favoriteAvailable=!0,hi.favoriteRemindOn=!!d.remind_on,hi.favoriteRemindOff=!!d.remind_off,hi.favoriteLimit=d.limit,hi.favoriteLimitNoticed=d.limit_noticed,hi.sendHintsLogHash=c,j.setIntroViewed(l)}a&&extend(cur.lang,a),s?stManager.add([jsc("web/stickers.js")],(function(){hi.updateEmojiList(t,o,e,r)})):hi.updateEmojiList(t,o,e,r),Object.assign(hi.stickerSizes,n),Object(E.isFunction)(i)&&i()},onFail:function(){r.emojiMoreSt=0}}),hi.curEmojiRecent&&r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate()}},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var r=e[i].stickers,n=r.length;n--;){var o=r[n];t[o[0]]={sticker:o,packId:i}}hi.stickersById=t},updateEmojiList:function(e,t,i,r){hi.stickers=e,r.emojiMoreSt=0,hi.stickers[-1]&&(ls.set("recent_stickers",hi.stickers[-1]),hi.updateRecentEmoji(i)),hi.stickers[-2],r.allEmojiId=0,r.sharedTT&&(r.sharedTT.emojiAllId=0),hi.onStickersLoad&&(r.afterLoad=1),hi.onStickersLoad&&window.emojiStickers&&(hi.onStickersLoad(),hi.onStickersLoad=!1);var n=hi.emojiGetRecentFromStorage();n?hi.curEmojiRecent=hi.filterEmoji(n):(hi.emojiOldRecentPrepare(t,i),hi.updateEmojiCont(i)),hi.updateRecentEmoji(i),r.onRecentEmojiUpdate&&r.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in a)if(a.hasOwnProperty(i))for(var r in a[i])if(a[i].hasOwnProperty(r)){var n=a[i][r],o=t.indexOf(n);if(-1!=o&&(t.splice(o,1),0==t.length))break e}var s={};for(var c in e)e.hasOwnProperty(c)&&-1==t.indexOf(c)&&(s[c]=e[c]);return t.length>0&&hi.setRecentEmojiList(s),s},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],n=void 0,o=void 0;isString(r)?(n=1,o=r):(n=r,o=i),t[o]=n}hi.setRecentEmojiList(hi.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in hi.curEmojiRecent)if(hi.curEmojiRecent.hasOwnProperty(t)){var i=hi.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n][0]);return r.slice(0,20)},incrRecentEmojiRate:function(e,t){hi.emojiRecentRateTime||(hi.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-hi.emojiRecentRateTime;if(i>=6){var r=Math.min(100,Math.floor(i/6));for(var n in hi.curEmojiRecent)if(hi.curEmojiRecent.hasOwnProperty(n)){if(n==t)continue;hi.curEmojiRecent[n]*=Math.pow(.998076,r)}hi.emojiRecentRateTime+=6*r}hi.curEmojiRecent[t]||(hi.curEmojiRecent[t]=0),hi.curEmojiRecent[t]+=1;var o=hi.getRecentEmojiSorted();a[-1]=o,o.length>=20&&-1==o.indexOf(t)&&(o.splice(-1),o.push(t));var s={};for(var c in o)if(o.hasOwnProperty(c)){var l=o[c];s[l]=hi.curEmojiRecent[l]}hi.setRecentEmojiList(s),window.Notifier&&Notifier.lcSend("recent_emoji_set",s)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),hi.curEmojiRecent=e},updateEmojiCont:function(e){var t=hi.opts[e];0==t.curTab&&(val(geByClass1("emoji_scroll_smiles",t.tt),hi.getInitEmojiContent(e)),hi.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",r=hi.emojiGetRecentFromStorage();r&&hi.setRecentEmojiList(r),a[-1]=hi.getRecentEmojiSorted();var n=t||hi.SORTED_EMOJI_SECTIONS_CODES;for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];i+=hi.getEmojiCategoryHtml(e,s)}return i},getInitEmojiContent:function(e){hi.setEmojiLastAddedCategoryIdx(e,1);return hi.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",r=a[t];if(!r.length)return i;var n=-1==t?"recent":t,o='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+Object(K.getLang)("global_emoji_cat_"+n)+"</div></div>";return i+=o+=hi.emojiGetCatCont(e,r)},getEmojiLastAddedCategoryIdx:function(e){return hi.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){hi.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=hi.opts[e],i=t.tt,r=hi.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,r){var n=geByClass1("emoji_scroll_smiles",i);if(r++,hi.SORTED_EMOJI_SECTIONS_CODES.length>r){var o=hi.SORTED_EMOJI_SECTIONS_CODES[r];n.insertAdjacentHTML("beforeEnd",hi.getEmojiCategoryHtml(e,o)),hi.setEmojiLastAddedCategoryIdx(e,r),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else debugLog("No emoji last category idx")},hideTt:function(e){removeClass(e,hi.SHOWN_TT_CLS)},showTt:function(e){addClass(e,hi.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",r="",n=t.length-1,o=0;o<=n;o++)r+=hi.emojiWrapItem(e,t[o],o),(o>0&&o%10==9||o>=n)&&(i+='<div class="emoji_smiles_row">'+r+"</div>",r="");return i},updateRecentEmoji:function(e){var t=hi.getRecentEmojiSorted(),i=hi.emojiGetCatCont(e,t),r=ge("emoji_recent_list"+e+"_-1");if(r){for(var n=r.nextSibling;n&&(n=n.nextSibling,hasClass(n.previousSibling,"emoji_smiles_row"));)re(n.previousSibling);for(var o=ce("div",{innerHTML:i}),s=r.nextSibling,a=r.parentNode;n=o.firstChild;)a.insertBefore(n,s)}},updateRecentStickers:function(e){var t=hi.opts[e];if(hi.stickers[hi.TAB_RECENT_STICKERS]&&t&&t.emojiExpanded){var i=ge("emoji_recent_stickers_cont"+e);if(i){val(i,"");for(var r=hi.stickers[hi.TAB_RECENT_STICKERS].stickers,n=cf(),o=0;o<r.length;o++){var s=hi.render.sticker(e,hi.TAB_RECENT_STICKERS,r[o]);n.appendChild(s);var a=68*Math.ceil((o+1)/4);t.needLoadStickers.unshift([e+"_"+hi.TAB_RECENT_STICKERS+"_"+r[o][0],a])}i.appendChild(n),hi.updateStickersPos(e)}}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,r=i.length;r--;)if(String(i[r][0])===String(t))return r;return-1},findSticker:function(e,t){var i=hi.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return hi.findStickerIndex(hi.stickers[hi.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return hi.findSticker(hi.stickers[hi.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return hi.findStickerIndex(hi.stickers[hi.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return hi.findSticker(hi.stickers[hi.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(hi.stickersById&&hi.stickersById.hasOwnProperty(e))return hi.stickersById[e].sticker},isStickersLoaded:function(){if(hi.stickers)for(var e in hi.stickers)if(hi.stickers.hasOwnProperty(e)&&e!==String(hi.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i=hi.TAB_FAVORITE_STICKERS,r="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+i;if(cur.stickersTab===i&&(r+=" emoji_tab_sel"),0===t&&hi.isStickersLoaded()){var n=hi.stickers[i];t=n?n.stickers.length:0}return 0===t&&(r+=" unshown"),'<a class="'+r+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'}},favorite:{reminder:function(e){var t=hasClass(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!hi[i]){var r={text:function(){return Object(K.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},n=domClosest("ui_scroll_container",e);r.appendEl=n;var o=domClosest("ui_scroll_overflow",e),s=getXYRect(e),a=getXYRect(o),c=s.top-a.top,l=(a.right,s.right,a.bottom-s.bottom),d=s.left-a.left,u=(a.width||a.right-a.left)/2;(!vk.rtl&&d>u||vk.rtl&&d<u)&&(r.needLeft=!0,r.shift[0]=9),r.forcetodown=c<hi.FAV_ICON_TT_MIN_HEIGHT,r.forcetoup=l<hi.FAV_ICON_TT_MIN_HEIGHT,Object(F.showTooltip)(e,r),hi[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},addFavoriteSticker:function(e,t,i){var r=hi.stickers[hi.TAB_FAVORITE_STICKERS];if(r){var n=hi.findPackSticker(t);if(n){n[4]=1,r.stickers.unshift(n);var o=hi.opts[e],s=o.deletedFavoriteStickers;for(o.deletedFavoriteStickers=[t];r.stickers.length>hi.favoriteLimit;)hi.favorite.deleteFavoriteSticker(e,r.stickers[r.stickers.length-1][0]);hi.favorite.deleteFavoriteStickerElements(e),o.deletedFavoriteStickers=s;var a=hi.findRecentSticker(t);a&&(a[4]=1);var c=ge("emoji_favorite_stickers_cont"+e);if(c){var l=hi.opts[e].emojiScroll.data.scrollHeight,d=hi.opts[e].emojiScroll.data.scrollTop,u=ge("emoji_sticker_item"+e+"_"+hi.TAB_FAVORITE_STICKERS+"_"+t);if(!u){u=hi.render.sticker(e,hi.TAB_FAVORITE_STICKERS,n),hi.render.stickerContent(e,u,!1);var f=domFC(c);f?domInsertBefore(u,f):c.appendChild(u),hi.opts[e].emojiScroll.update();var _=hi.opts[e].emojiScroll.data.scrollHeight-l;hi.opts[e].emojiScroll.scrollTop(d+_),hi.updateStickersPos(e)}}var m=geByClass1("emoji_tab_"+hi.TAB_FAVORITE_STICKERS);if(hasClass(m,"unshown")&&(hi.opts[e].curTab===hi.TAB_FAVORITE_STICKERS&&removeClass(geByClass1("emoji_tab_"+hi.TAB_RECENT_STICKERS),"emoji_tab_sel"),removeClass(m,"unshown")),hi.favorite.updateFavoriteStickerElements(e,t,!0),hi.opts[e].deletedFavoriteStickers.length>0){var p=indexOf(hi.opts[e].deletedFavoriteStickers,t);-1!==p&&hi.opts[e].deletedFavoriteStickers.splice(p,1)}}}},deleteFavoriteSticker:function(e,t,i){var r=hi.stickers[hi.TAB_FAVORITE_STICKERS];if(r){var n=hi.findFavoriteStickerIndex(t);if(-1!==n){if(r.stickers.splice(n,1),hi.opts[e].deletedFavoriteStickers.push(t),0===r.stickers.length&&i)addClass(geByClass1("emoji_tab_"+hi.TAB_FAVORITE_STICKERS),"unshown"),domData(i.parentElement,"pack-id")===String(hi.TAB_FAVORITE_STICKERS)&&addClass(geByClass1("emoji_tab_"+hi.TAB_RECENT_STICKERS),"emoji_tab_sel");hi.favorite.updateFavoriteStickerElements(e,t,!1);var o=hi.findRecentSticker(t);o&&(o[4]=0);var s=hi.findPackSticker(t);s&&(s[4]=0)}}},deleteFavoriteStickerElement:function(e,t){re("emoji_sticker_item"+e+"_"+hi.TAB_FAVORITE_STICKERS+"_"+t)},deleteFavoriteStickerElements:function(e){var t=hi.opts[e];t.deletedFavoriteStickers.length>0&&(t.deletedFavoriteStickers.forEach((function(t){hi.favorite.deleteFavoriteStickerElement(e,t)})),t.deletedFavoriteStickers=[],hi.updateStickersPos(e))},deleteFavoriteStickerElementsAsync:function(e){var t=hi.opts[e];t.deleteFavoriteStickersTimeout||(t.deleteFavoriteStickersTimeout=setTimeout((function(){hi.favorite.deleteFavoriteStickerElements(e),t.deleteFavoriteStickersTimeout=null}),hi.DELETE_FAV_STICKER_ELEMENTS_DELAY))},updateFavoriteStickerElements:function(e,t,i){geByClass("sticker_item_"+t).forEach((function(e){domData(e,"fav",i?"1":null),toggleClass(e,"faved",i),toggleClass(geByClass1("emoji_sticker_item_fav",e),"on",i)}))}},updateEmojiCatTitle:function(e){var t=hi.opts[e];if(t&&t.emojiScroll){var i,r,n,o=ge("emoji_block_"+e),s=geByClass("emoji_cat_title_helper",o),a=t.emojiScroll.data.scrollTop,c=geByClass1("emoji_cats_title_helper",t.tt);if(s.length){var l=s[0];i=hi.getSizeCached(l)[1]}for(var d=s.length-1;d>=0;d--)if(a>s[d].offsetTop-i){r=s[d],n=d;break}if(!r)return debugLog("title not found");var u=intval(attr(r,"data-id"));if(t.curEmojiCatId!=u){t.curEmojiCatId=u;var f=[r],_=s[n-1];_&&(addClass(_,"emoji_cat_title_fix"),setStyle(_.firstChild,"transform","translateY("+(r.offsetTop-_.offsetTop-i)+"px)"));for(var m=r.nextSibling;m;)hasClass(m,"emoji_cat_title_fix")&&f.push(m),m=m.nextSibling;for(var p in f)f.hasOwnProperty(p)&&(removeClass(f[p],"emoji_cat_title_fix"),setStyle(f[p].firstChild,"transform","translateY(0px)"));val(c,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=r.offsetTop&&a>0?(val(c,val(r)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<r.offsetTop||0==a)&&(val(c,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var r,n=hi.cssEmoji[t];r=n?' title="'+n[1]+'"':"";var o="";return browser.mobile||(o=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+r+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+o+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+hi.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=hi.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),clearTimeout(cur.ttEmojiHide),hi.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||ge("page_header")&&hi.getSizeCached(ge("page_header"))[1]||0;var r=(window.pageNode&&window.browser.mozilla?Math.min(getSize(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||getScroll()[3],n=window.scrollGetY?scrollGetY():getScroll()[1],o=getXY(t)[1],s=hi.getSizeCached(t)[1],a=geByClass1("emoji_list",i),c=hi.opts[e].emojiSmileHeigh,l=window.headH,d=hi.opts[e].emojiRowsCount;isAncestor(t,pageNode)||(l=0),setStyle(a,{height:d*c+8});for(var f,_,m,p,h=n+l,v=n+r,g=i,k=getSize(i)[1];g!==bodyNode&&(g=Object(u.domClosestOverflowHidden)(g));){var S=getXY(g)[1];h=Math.max(h,S),v=Math.min(v,S+getSize(g)[1])}for(m=v-o-s-9,f=(_=o-9-h)<k&&m<k?_>=m:_>=k,hi.opts[e].forceUp&&(f=!0),p=f?_:m;p<k&&d>3;)d--,k-=c;hi.opts[e].emojiRowsCount=d,hi.opts[e].emojiSmileHeigh=c,setStyle(a,{height:d*c+8}),toggleClass(i,"tt_down",f),toggleClass(i,"tt_up",!f)},repositionEmoji:function(e,t,i){var r,n=hi.opts[e];if(n){if(i.parentNode&&getXY&&getStyle&&setStyle&&geByClass&&(r=geByClass1("emoji_rpointer",i))){var o=parseInt(getStyle(i,"width")),s=getXY(t)[0],a=parseInt(getStyle(t,"width")),c=getXY(i.parentNode)[0];s+a/2<283?(setStyle(i,"left",-o-c),setStyle(r,"left",s+a/2-20+"px")):(setStyle(i,"left",""),setStyle(r,"left",""))}else setStyle(i,"left","");var l=geByClass1("emoji_list",i),d=geByClass1("emoji_smile_cont",l);if(hi.opts[e].emojiSmileHeigh=d&&hi.getSizeCached(d)[1]||26,hi.opts[e].emojiRowsCount=9,hi.ttCalcHeight(e,t,i),n.ttWrap){var u=getSize(n.ttWrap)[0]-(getXY(n.emojiBtn)[0]-getXY(n.ttWrap)[0]);setStyle(i,"right",u-n.ttDiff+"px")}}},emojiOver:function(e,t,i){if(browser.mobile||i&&hi.preventMouseOver)return!0;var r=hi.opts[e];addClass(t,"emoji_over"),r.emojiOvered&&r.emojiOvered!=t&&removeClass(r.emojiOvered,"emoji_over"),r.emojiOvered=t},emojiExpand:function(e,t){var i=hi.opts[e];addClass(t,"emoji_expanded"),hi.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll(geByClass1("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,Object(E.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i.curTab==hi.TAB_EMOJI?hi.updateEmojiCategories(t,i,e):hi.updateShownStickers(e)}}),i.imagesLoader=i.imagesLoader||imagesLoader(i.emojiScroll.scroller,{use_iframe:!0,need_load_class:"emoji_need_load"}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-hi.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){hi.addNextEmojiCategoty(i),hi.updateEmojiCatTitle(i)}),0),hi.updateEmojiCatTitle(i)},updateShownStickers:function(e,t){var i=hi.opts[e];if(i.emojiScroll&&i.stickersSplitersPos){i.needLoadStickers||(i.needLoadStickers=[]);var r=i.emojiScroll.data.scrollTop,n=r,o=r+i.emojiScroll.data.viewportHeight,s=i.needLoadStickers;clearTimeout(i.preloadStickersTimer);for(var a=[],c=0;c<s.length;c++){var l=s[c];if(l[1]+72>=n&&l[1]<=o){var d=ge("emoji_sticker_item"+l[0]);if(!d||hasClass(d,"__loaded"))continue;var u=hi.render.stickerContent(e,d,!0);a.push([u,l[0]])}}if(hi.loadStickers(e,a),a.length||hi.preloadStickers(e),!(t||i.scrollAnimation||hi.onStickersLoad)){for(var f=-1,_=0;_<i.stickersSplitersPos.length;_++){var m=i.stickersSplitersPos[_];if(!(m[1]-30<r))break;f=m[0]}f!=hi.TAB_FAVORITE_STICKERS&&hi.favorite.deleteFavoriteStickerElementsAsync(e),i.curTab!=f&&hi.scrollToTab(f,e)}}},loadStickers:function(e,t){var i=hi.opts[e];if(t.length){for(var r={},n=0;n<t.length;n++){var o=t[n][0]+":"+t[n][1];i.imagesLoading[o]&&(r[o]=i.imagesLoading[o],delete i.imagesLoading[o],t.splice(n,1),n--)}for(var s in i.imagesLoading)if(i.imagesLoading.hasOwnProperty(s)){var a=i.imagesLoading[s];if(!a)return;a.src=""}for(var c in i.imagesLoading=r,t)if(t.hasOwnProperty(c)){var l=t[c][0]+":"+t[c][1];i.imagesLoading[l]=i.imagesLoader.iloader.add(t[c][0],hi.onStickerLoaded,e+":"+t[c][1])}}},preloadStickers:function(e){var t=hi.opts[e];t.imagesLoading&&Object.keys(t.imagesLoading).length>0||(clearTimeout(t.preloadStickersTimer),t.preloadStickersTimer=setTimeout((function(){var i=t.emojiScroll.data.scrollTop,r=t.emojiScroll.data.viewportHeight,n=i+r,o=i-r,s=i,a=n,c=n+r,l=geByClass1("emoji_scroll_stickers",t.tt);if(isVisible(l)){for(var d=l.firstChild,u=[];d;){if(hasClass(d,"emoji_sticker_item")&&!hasClass(d,"__loaded")){var f=d.offsetTop;if(f>=o&&f<=s||f>=a&&f<=c){var _=d.id.replace("emoji_sticker_item",""),m=hi.render.stickerContent(e,d,!0);u.push([m,_])}}d=d.nextSibling}hi.loadStickers(e,u)}}),50))},onStickerLoaded:function(e){var t=String(this).split(":"),i=t[1],r=intval(t[0]),n=hi.opts[r],o=ge("emoji_sticker_item"+i);if(o){var s=geByTag1("img",o);if(s){addClass(o,"__loaded"),attr(s,"src",e),delete hi.opts[r].imagesLoading[e+":"+i];for(var a=0;a<n.needLoadStickers.length;a++){if(i==n.needLoadStickers[a][0]){n.needLoadStickers.splice(a,1);break}}Object.keys(hi.opts[r].imagesLoading).length||hi.preloadStickers(r)}}},emojiMove:function(e){var t=hi.shownId,i=hi.opts[t];if(hi.shown&&i&&i.emojiFocused&&i.openedByTabKey){var r=null;if(i.emojiOvered)switch(e.keyCode){case KEY.LEFT:r=hi.getEmojiEl(i.emojiOvered,"left"),cancelEvent(e);break;case KEY.RIGHT:r=hi.getEmojiEl(i.emojiOvered,"right"),cancelEvent(e);break;case KEY.UP:r=hi.getEmojiEl(i.emojiOvered,"up");break;case KEY.DOWN:r=hi.getEmojiEl(i.emojiOvered,"down");break;case KEY.ENTER:if(!hi.emojiEnter(t,e))return cancelEvent(e),!1;break;default:return!0}else r=hi.getFirstEmojiEl(t);if(r)return hi.preventMouseOver=!0,hi.emojiOver(t,r),hi.scrollToListEl(t,r),!1}return!0},scrollToListEl:function(e,t){var i=hi.opts[e];if(i&&i.emojiScroll){var r=t.offsetTop,n=Math.max(r+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,r-30));i.emojiScroll.data.scrollTop!=n&&i.emojiScroll.scrollTop(n)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),r=0,n=domLC(e),o=domFC(e),s=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var d=++r>=i?a:s+1.95*r*(t?1:-1),u=d-45,f=r>=i?l:c+1/(300/13)*r*(t?-1:1),_=1-f;n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+d+"deg)",o.style.WebkitTransform=o.style.OTransform=o.style.transform="rotate("+u+"deg)",n.style.opacity=f,o.style.opacity=_,r>=i&&(clearInterval(cur._imAnim),(t?addClass:removeClass)(e,"emoji_smile_on"),n.style.WebkitTransform=n.style.OTransform=n.style.transform=o.style.WebkitTransform=o.style.OTransform=o.style.transform=n.style.opacity=o.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:o.emojiToHTML,emojiReplace:o.emojiReplace,emojiRegex:Object(r.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){li(e,{settings:!0})},updatePeerInfo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=hi.opts[e];if("im"===cur.module&&cur.gid)this.renderPeerInfo(e,null);else{var r=this.getPeerId(e);(r!==i.currentPeerId||t)&&(i.currentPeerId=r,r?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(r).then(t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),r===i.currentPeerId&&this.renderPeerInfo(e,t)})):this.renderPeerInfo(e,null))}},renderPeerInfo(e,t){var i=hi.opts[e];if(t){i.tt.classList.remove("emoji_tt_peer_info_unavailable");var r=t.product_ids.reduce((e,t)=>(e[t]=1,e),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach(e=>{var i=e.dataset.productId;if(r.hasOwnProperty(i)){var n=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 106 0a6 6 0 000 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 011.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${n?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""})}else i.tt.classList.add("emoji_tt_peer_info_unavailable")},showPeerInfoTooltip(e){Object(F.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e,t){var i="";if(t){var r,n="",o="",s=hi.opts[e].forceStickerPack,a=ui(window.emojiStickers);try{for(a.s();!(r=a.n()).done;){var c=r.value,l=c[0],d=l===hi.TAB_RECENT_STICKERS,u=l===hi.TAB_FAVORITE_STICKERS,f=c[1],_=c[4]&&s==l;if(f||_){var m=c[8];if(hi.stickers.hasOwnProperty(l)){var p=hi.stickers[l],h=p.stickers,v=p.title,g=p.base_id,k=p.can_gift,S='<div class="clear emoji_stickers_spliter" id="emoji_tab_cont_'+l+"_"+e+'"></div>';if(d)S+='<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont'+e+'">';else if(u)S+='<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont'+e+'">';else{if(S+=`\n        <div class="clear emoji_stickers_pack_header">\n          <div class="emoji_stickers_pack_header_main">\n            <div class="emoji_stickers_pack_title">${v}</div>`,g&&!vk.widget)S+=`<a class="${Object(G.classNames)("emoji_stickers_pack_select_style",{"emoji_stickers_pack_select_style--new":m})}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${g});" title="${Object(K.getLang)("purchases_stickers_select_style")}"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M10.6 2c.98.03 1.63.58 1.96 1.6l.06.18.04.15.06.2.04.13.03.01.06-.02.1-.04.13-.06c1.16-.53 2.05-.43 2.78.36l.1.12.67.83c.6.8.58 1.63 0 2.54l-.1.15-.1.14-.12.16-.05.1-.03.04v.02l.08.05.1.06.13.07c1.13.58 1.6 1.35 1.42 2.4l-.03.16-.2.87c-.13.56-.23.82-.63 1.19-.39.35-.83.5-1.42.55h-.18l-.16.01-.2.01-.15.02.01.12.01.08.03.14c.26 1.25-.03 2.1-.97 2.62l-.14.08-.96.47c-.9.4-1.72.2-2.48-.58l-.12-.13-.11-.13-.14-.15-.08-.08-.04-.04-.07.08-.09.08-.1.11c-.78.93-1.6 1.27-2.6.88L7 17.49l-.86-.42-.26-.13c-.39-.22-.6-.42-.82-.87a2.38 2.38 0 01-.13-1.54l.03-.19.04-.2L5 14 4.93 14l-.12-.01h-.15c-1.27-.03-2.03-.51-2.33-1.55l-.04-.15-.24-1.04c-.2-.97.2-1.72 1.11-2.28l.16-.1.15-.07.17-.1.13-.08v-.02l-.05-.08-.06-.1-.09-.12c-.76-1.02-.85-1.92-.22-2.8l.1-.12.67-.83c.64-.75 1.47-.9 2.48-.52l.17.07.15.06.18.08.11.04.03-.01.03-.08.04-.11.03-.14c.3-1.17.9-1.83 1.96-1.92L9.46 2zm-.05 1.47h-1.1l-.1.01c-.24.03-.4.16-.54.68l-.04.13-.04.17c-.09.29-.22.61-.39.93a4.8 4.8 0 00-.94.46 5.28 5.28 0 01-.95-.29l-.28-.13c-.2-.08-.36-.13-.48-.14h-.07a.45.45 0 00-.33.16l-.06.06-.64.8-.08.1c-.15.21-.17.4.16.88l.18.25c.18.26.35.57.5.9-.11.32-.19.65-.23.99a5.3 5.3 0 01-.83.6l-.28.14c-.5.28-.57.46-.53.72l.01.06.23 1 .04.13c.07.25.21.39.79.41l.32.02c.3.01.65.07 1 .16.18.29.4.55.63.8.02.43-.02.85-.1 1.18-.16.78 0 .9.32 1.06l.92.45c.1.05.19.07.28.07h.05c.15-.02.32-.13.55-.4l.21-.24c.21-.23.48-.47.78-.68l.24.01h.5l.24-.02c.3.22.57.46.78.69l.21.24c.27.3.44.4.6.4h.06c.05 0 .1-.02.14-.04l.08-.03.92-.45.12-.06c.24-.14.34-.32.2-1a5.07 5.07 0 01-.1-1.18c.24-.25.45-.51.64-.8.34-.1.7-.15 1-.16l.31-.02c.67-.03.75-.2.83-.54l.22-.93c.07-.33.07-.53-.5-.85l-.29-.15a5.26 5.26 0 01-.83-.59 4.87 4.87 0 00-.22-.98c.14-.34.32-.65.49-.9l.19-.26c.33-.48.3-.67.16-.88l-.04-.06-.65-.8c-.11-.13-.2-.23-.37-.26h-.06c-.13 0-.3.04-.54.14l-.3.13c-.27.11-.6.22-.94.28-.3-.18-.61-.33-.94-.45-.16-.3-.29-.62-.37-.9l-.1-.33c-.15-.56-.32-.66-.58-.68zM10 6.9a3.11 3.11 0 110 6.23 3.11 3.11 0 010-6.23zm0 1.48a1.64 1.64 0 100 3.27 1.64 1.64 0 000-3.27z" fill="currentColor"/></svg></a>`;if(S+='\n          </div>\n          <div class="emoji_stickers_pack_header_aside">',k&&!vk.widget)S+=`\n            <div\n              class="emoji_stickers_pack_peer_info"\n              data-product-id="${l}"\n              ${g&&g!==l?"data-is-style":""}\n            ></div>\n            <a\n              class="emoji_stickers_pack_gift"\n              onclick="Emoji.giftStickerToCurrentPeer(${e}, ${l}, event, { sticker_referrer: &quot;stickers_keyboard&quot; });"\n            >\n              <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 013 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 01-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 01-1.32-1.32l-.1-.2A5.12 5.12 0 013 14.3V12.4a1.88 1.88 0 01-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 013-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26zM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5zM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5zM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04zm1.56 0l-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>\n            </a>`;S+="\n          </div>\n        </div>"}var w,b=ui(h);try{for(b.s();!(w=b.n()).done;){var y=w.value;S+=hi.render.stickerRs(e,l,y)}}catch(e){b.e(e)}finally{b.f()}d?n=S+"</div>":u?o=S+"</div>":_?i=S+i:i+=S}}}}catch(e){a.e(e)}finally{a.f()}i=o+n+i}else i=hi.ttEmojiList(e);return i},updateStickersCont:function(e){var t=hi.opts[e],i=hi.getTabCont(e,hi.tabDefaultId);geByClass1("emoji_scroll_stickers",t.tt).innerHTML=i,t.initedStickers=1,t.imagesLoading=[],clearTimeout(t.preloadStickersTimer),hi.updateStickersPos(e)},updateStickersPos:function(e){for(var t=hi.opts[e],i=[],r=[],n=geByClass1("emoji_scroll_stickers",t.tt).firstChild,o=!1,s=!1;n;){if(!o&&hasClass(n,"emoji_recent_stickers_cont")?(n=n.firstChild,o=!0):!s&&hasClass(n,"emoji_favorite_stickers_cont")&&n.firstChild&&(n=n.firstChild,s=!0),hasClass(n,"emoji_sticker_item")){var a=n.id.replace("emoji_sticker_item","");i.push([a,n.offsetTop])}else if(hasClass(n,"emoji_stickers_spliter")){var c=n.id.replace("emoji_tab_cont_","").split("_");r.push([intval(c[0]),n.offsetTop])}(!n.nextSibling&&o||!n.nextSibling&&s)&&(n=n.parentNode),n=n.nextSibling}t.needLoadStickers=i,t.stickersSplitersPos=r},stickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},stickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-animation-path="%animationUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i,r){if(null!=e){var n=hi.opts[i],o=n.tt;"number"==typeof e&&(e=geByClass1("emoji_tab_"+e,o));var s=geByClass1("emoji_scroll_smiles",o),a=geByClass1("emoji_scroll_stickers",o),c=geByClass1("emoji_cats_title_helper",o);if(val(c,""),n.curEmojiCatId=null,t==hi.TAB_EMOJI)hide(a),show(s),show(c),n.emojiInited||(val(s,hi.getInitEmojiContent(i)),n.emojiInited=!0),n.imagesLoader&&n.imagesLoader.processLoad(),n.emojiOvered&&0===n.curTab&&hi.emojiOver(i,hi.getFirstEmojiEl(i)),n.curTab!=hi.TAB_EMOJI&&n.emojiScroll&&n.emojiScroll.scrollTop(0),hi.updateRecentEmoji(i),hi.updateEmojiCatTitle(i);else{hide(s),show(a),hide(c);var l=hi.stickers&&clone(hi.stickers);if(l&&delete l[hi.TAB_RECENT_STICKERS],!window.emojiStickers||!l||isEmpty(l)||!l[t]&&t!=hi.TAB_RECENT_STICKERS)hi.onStickersLoad=function(){hi.updateTabsOpt(i),hi.tabSwitch(t,t,i,r)},hi.stickersLoadingProgress(i,t,e),n.stickersInited=!1,n.curTab=null,hi.emojiLoadMore(i);else{var d=window.emojiStickers.find(e=>e[0]===t);d&&d[7]&&Ce(t,W.IsNew,0,!1).then(()=>{Array.from(document.querySelectorAll(".emoji_tab_"+t)).forEach(e=>{e.classList.remove("emoji_tab_is_new")})}),n.stickersInited||(hi.updateStickersCont(i),n.stickersInited=!0)}(n.curTab!=t||n.afterLoad)&&(hi.scrollToStickerPack(i,t,n.curTab==hi.TAB_EMOJI),n.afterLoad=0),hi.updateShownStickers(i,!0),n.stickersInited&&hi.updatePeerInfo(i)}hi.onStickersLoad&&t!=hi.TAB_EMOJI||hi.selectTab(i,t,e)}},getFirstEmojiEl:function(e){for(var t=hi.opts[e],i=geByClass1("emoji_scroll_smiles",t.tt).firstChild;i;){if(hasClass(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,r=0,n=e.parentNode,o=0,s=n.firstChild;s&&(o++,s!==e);)s=s.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",o=10):(t="down",o=1));else{if("up"!=t&&"down"!=t)break;for(var a=n;a&&(a="up"==t?a.previousSibling:a.nextSibling)&&!hasClass(a,"emoji_smiles_row"););if(!a)break;if(o&&a)for(var c=0,l=a.firstChild;l&&c<o;){if(++c>=o){i=l;break}l=l.nextSibling}if(i||!a)break;i="up"==t||o&&"down"==t?a.lastChild:a.firstChild}if(++r>20){debugLog("ERR!!");break}}return i},stickerClick:function(e,t,i,r,n,o){var s=hi.opts[e];if(!(Date.now()-s.ttShowT<hi.CLICK_DELAY||s.preventDoubleClick&&Date.now()-s.preventDoubleClick<hi.CLICK_DELAY)){hi.opts[e].preventDoubleClick=Date.now();var a=parseInt(attr(n,"data-pack-id")),c=!0;if(window.emojiStickers&&each(window.emojiStickers,(function(e,t){if(t[0]==a)return c=!!t[1],!1})),c){var l=hi.findRecentStickerIndex(t);-1!==l?hi.stickers[hi.TAB_RECENT_STICKERS].stickers.splice(l,1):hi.stickers[hi.TAB_RECENT_STICKERS]||(hi.stickers[hi.TAB_RECENT_STICKERS]={stickers:[]});var d=domData(n,"animation-path")||"",u=domData(n,"fav"),f=domData(n,"fav-hash");hi.stickers[hi.TAB_RECENT_STICKERS].stickers.unshift([t,i,r,d,u,f]),ls.set("recent_stickers",hi.stickers[hi.TAB_RECENT_STICKERS]),s.needUpdateRecentStickers=!0}s.onStickerSend&&s.onStickerSend(t,o,"animation"),statlogsValueEvent("stickers_usage",s.ref,t,o),hi.ttHide(e,!1,!1,!0),s.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if(isObject(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var r=(cur.tooltips||[]).length,n=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+r,e.image?"":"tt_text_only"];if(n=n.join(" "),e.show){var o={index:r,className:n,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=getSize(e.container)[1];if(!(i>=225)){var r=intval((225-i)/2)+10,n=intval(getStyle(t,"top",!0));setStyle(t,"top",n+r)}}};gpeByClass("_im_peer_history_w",t)&&(o.appendParentCls="_im_peer_history_w"),Object(F.showTooltip)(t,o)}}})},selectPeer:function(e){if(void 0!==e){var t=hi.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var r=0;for(var n in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(n)&&(i=cur.wdd.imw_dd.selected[n][0],r+=1);r>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=showBox("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){var e=document.querySelector("#im_stickers_tabs");if(e){var t=e.querySelector(".ui_tab_sel");if(t)return fi(t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[],2)[1]}},showStickersStore:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=hi.selectPeer(!1!==e?e:void 0),o=hi.opts[e];i=di({},i,{act:"stickers_store",peer:n,box:1}),t&&(i.ref=t),cur.boxStickersStore=showBox("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",jsc("web/sorter.js")],params:{onDestroy(){o&&o.onStoreHide&&o.onStoreHide(),cur.boxStickersStore=null}},onDone(){void 0!==r.scrollTop&&(Fe().scrollTop=r.scrollTop)}}),cur.boxStickersStore.reload=()=>{if(cur.boxStickersStore){var i=hi.getSelectedStickersStoreTabId(),r=Fe().scrollTop;cur.boxStickersStore.hide(),hi.showStickersStore(e,t,{tab:i},{scrollTop:r})}},hi.hideStickersStoreNotification(),each(geByClass("emoji_shop_icon_badge"),(function(e,t){re(t)})),hi.hasNewStickers=!1},previewSticker:function(e,t,i,r){if(pi()){var n=(i=i||{}).peerId||hi.selectPeer(),o={recipientIds:n?[n]:[],preview_ref:i.sticker_referrer||"store"};return i.stickerId?ci(i.stickerId,o):li(e,o),cancelEvent(r),!1}if(i=i||{},r&&checkEvent(r))return!0;var s={act:"sticker_preview",pack_id:e},a=hi.selectPeer();if(i.peer?s.peer=i.peer:a&&(s.peer=a),i.preview&&(s.preview=1),i.gift&&(s.gift=1),i.giftTo&&(s.gift_to=i.giftTo),i.stickerId&&(s.sticker_id=i.stickerId),s.sticker_referrer=i.sticker_referrer||"store",i.name){var c=nav.objLoc[0].split("/");"stickers"==c[0]&&c[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=showBox("al_im.php",s,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),cancelEvent(r),!1},isStickerPackEnabled:function(e,t){var i=!1;if(!window.emojiStickers&&t)return ajax.post("al_im.php",{act:"a_stickers_list"},{onDone:function(e){window.emojiStickers=e,t()}}),0;if(!window.emojiStickers)return!1;for(var r in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(r)&&window.emojiStickers[r][0]==e){i=!!window.emojiStickers[r][1];break}return i},clickSticker:function(e,t,i){if(window.cur.emojiStickersDisabled&&window.cur.emojiStickersDisabled[e])return!0;var r;if(t){if(0===(r=hi.isStickerPackEnabled(e,hi.clickSticker.pbind(e,t,i))))return!1;if(r){var n=!1;if(t.getAttribute("contenteditable"))n=t;else{for(var o=t.parentNode,s=!1;(o=o.parentNode)&&!hasClass(o,"js-im-page");){if(hasClass(o,"fc_tab")){s=!0;break}if(hasClass(o,"mv_chat"))break}if(!o)return!1;s?n=geByClass1("fc_editable",o):hasClass(o,"js-im-page")?n=geByClass1("_im_text"):hasClass(o,"mv_chat")&&(n=domByClass(o,"mv_chat_reply_input"))}if(n){var a=hi.opts[n.emojiId];hi.ttClick(n.emojiId,geByClass1("_emoji_btn",n.parentNode.parentNode),!1,!0);var c=geByClass1("emoji_tab_"+e,a.tt),l=hi.stickers&&clone(hi.stickers);l&&delete l[-1],!l||isEmpty(l)?(hi.onStickersLoad=hi.tabSwitch.pbind(e,e,n.emojiId),hi.stickersLoadingProgress(n.emojiId,e,c)):(a.initedStickers=0,hi.tabSwitch(c,e,n.emojiId))}}}return t&&r||hi.previewSticker(e,!1,{sticker_referrer:"message"}),i&&cancelEvent(i),!1},stickersLoadingProgress:function(e,t,i){var r=hi.opts[e];removeClass(geByClass1("emoji_tab_sel",r.tt),"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),geByClass1("emoji_scroll_stickers",r.tt).innerHTML='<div class="emoji_scroll_progress">'+rs(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,r,n){if(i&&hasClass(i,"secondary"))return!0;if(pi())return Object(M.lockButton)(i),Be.create([e]).order({ref:n}).then(t=>{if(Object(M.unlockButton)(i),t&&!t.error){showDoneBox(ze(t));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===n&&window.Videoview&&window.Videoview.onStickersPurchased(e),Object(l.partConfigEnabled)("stickers_catalog_reload_after_buy")&&(cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:hi.getSelectedStickersStoreTabId()},preventScroll:!0}))}}),cancelEvent(t);var o=hi.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:r,peer:o,sticker_referrer:unclean(n)},{onDone:function(t,i,r,o,s,a){if(each(geByClass("_sticker_btn_"+e),(function(){this.innerHTML=o,this.onmouseover="",this.onclick="",addClass(this,"secondary")})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),s&&cur.boxStickersStore&&cur.boxStickersStore.hide(),showDoneBox(t),i){hi.stickers[hi.TAB_RECENT_STICKERS].promoted=a,hi.updateTabs(i,r,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===n&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var c=cur.tabbedStickersBox;if(c&&c.tbUpdate)for(var d in c.tbUpdate)c.tbUpdate.hasOwnProperty(d)&&(c.tbUpdate[d]=1);var u=cur.emojiId&&cur.emojiId[cur.peer];if(u){var f=geByClass1("emoji_tab_"+e,hi.opts[u].tt);f&&hi.tabSwitch(f,e,u)}Object(l.partConfigEnabled)("stickers_catalog_reload_after_buy")&&nav.reload({preventScroll:!0})},showProgress:M.lockButton.pbind(i),hideProgress:M.unlockButton.pbind(i),onFail:function(e){return e&&setTimeout(Object(D.showFastBox)(Object(K.getLang)("global_error"),e).hide,3e3),!0}}),cancelEvent(t)},stickerAct:function(e,t,i,r,n){if(n&&hasClass(e,"secondary"))return!0;var o=(n?hasClass(e,"secondary"):hasClass(e,"_im_sticker_activated"))?1:0,s=cur.tabbedStickersBox;if(s)for(var a in s.tbUpdate)s.tbUpdate.hasOwnProperty(a)&&(s.tbUpdate[a]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:o,from_btn:n?1:0},{onDone:function(i,r,s,a){n||(e.innerHTML=i,e.onmouseover="",setStyle(e,{width:"auto"}),toggleClass(e,"_im_sticker_activated",!o)),each(geByClass("_sticker_btn_"+t),(function(){this.innerHTML=a,this.onmouseover="",toggleClass(this,"secondary",!o)})),hi.updateTabs(r,s,!0);var c=e.parentNode.parentNode;if(!n){if(cur.stickersSorter.destroy(),o){show("im_stickers_deact");var l=ge("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),setStyle(c,{cursor:"default"})}else{geByTag1("div","im_stickers_my_wrap").appendChild(c),ge("im_stickers_deact_wrap").childNodes.length||hide("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:M.lockButton.pbind(e),hideProgress:M.unlockButton.pbind(e)}),cancelEvent(r)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(hi.hasNewStickers=!1);for(var r=hi.opts[t].forceStickerPack,n="",o="",s=0,a=i;s<a.length;s++){var c=a[s],l=c[0],d=c[1],u=c[3],f=c[4]&&l===r,_=c[5];if(d||u||f){var m=c[6],p=c[7],h=c[8],v=void 0;if(d||f?(l>0&&-1===hi.stickerPacksToLoad.indexOf(l)&&hi.stickerPacksToLoad.push(l),v="Emoji.tabSwitch(this, "+l+", "+t+"); return cancelEvent(event);"):v="Emoji.previewSticker("+l+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",c[2]&&(hi.hasNewStickers=c[2]),l===hi.TAB_RECENT_STICKERS){var g="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+l;cur.stickersTab==l&&(g+=" emoji_tab_sel"),n+='<a class="'+g+'" onmousedown="'+v+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(l===hi.TAB_FAVORITE_STICKERS)n+=hi.tabs.favoriteTabContent(v,m);else if(l){var k="emoji_tab emoji_tab_img_cont emoji_tab_"+l;(p||h)&&(k+=" emoji_tab_is_new"),cur.stickersTab==l&&(k+=" emoji_tab_sel"),d||f||(k+=" emoji_tab_promo");var S='<a class="'+k+'" onmousedown="'+v+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+_+'" class="emoji_tab_img" /></a>';f?o=S+o:o+=S}else{var w="emoji_tab emoji_tab_"+l;cur.stickersTab==l&&(w+=" emoji_tab_sel"),d||(w+=" emoji_tab_promo"),n+='<a class="'+w+'" onmousedown="'+v+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+l+'"></div></a>'}}}return n+o},updateTabsOpt:function(e,t){var i=hi.opts[e];if(!i.noStickers){var r=ge("emoji_tabs_cont_"+e);r&&(r.innerHTML=hi.getTabsCode(window.emojiStickers,e)),hi.checkEmojiSlider(i),hi.checkNewStickers(i),void 0!==typeof t&&(i.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var r=0;for(var n in void 0===t?(hi.initStickersKeywords(),window.stickersKeywordsData||(r=1)):(window.stickersKeywordsData=t,hi.setStickersKeywords(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:r,cache_time:hi.cachedStickersKeywordsTime()},{onDone:hi.updateTabs}):window.emojiStickers=e,hi.opts)hi.opts.hasOwnProperty(n)&&hi.updateTabsOpt(n,!1);var o=hi.stickers&&clone(hi.stickers);o&&delete o[hi.TAB_RECENT_STICKERS],hi.onStickersLoad&&window.emojiStickers&&!isEmpty(o)&&(hi.onStickersLoad(),hi.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter(e=>!e.querySelector(".emoji_smile_icon_promo")).forEach(e=>{e.appendChild(ce("div",{className:"emoji_smile_icon_promo"}))});var e=document.querySelector("#l_stickers");e&&e.classList.add("AppLeftMenuWithNotify")},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach(e=>{e.parentNode.removeChild(e)});var e=document.querySelector("#l_stickers");e&&e.classList.remove("AppLeftMenuWithNotify")},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){hi.hasNewStickers=window.emojiStickers[i][2];break}hi.hasNewStickers<0&&!hi.noNewStickers&&setTimeout(()=>hi.showStickersStoreNotification(),hasClass(t,"fc_editable")?200:0)}},checkEmojiSlider:function(e){var t=geByClass1("emoji_tabs_wrap",e.tt),i=!1;if(t){if(t.firstChild.clientWidth&&t.firstChild.clientWidth>t.clientWidth+t.scrollLeft)i=!0;else{var r=t.firstChild.childNodes;r.length>6&&(e.scrollLeft||0)<34*(r.length-6)-16&&(i=!0)}var n=vk.rtl?"l":"r";i?(e.sliderShown=!0,hi.scrollToggleArrow(!0,n,e,!0)):e.sliderShown&&(e.sliderShown=!1,hi.scrollToggleArrow(!1,n,e,!0))}},giftStickerToCurrentPeer(e,t,i,r){var n=this.getPeerId(e);Object(z.isUserPeer)(n)||Object(z.isChatPeer)(n)?this.giftSticker(t,n,i,r):this.giftSticker(t,"",i,r)},giftSticker:function(e,t,i,r){if(pi())return Jt([e],String(t).split(",").map(e=>Number(e)),{ref:r.sticker_referrer||"store",gift_ref:r.ref}),cancelEvent(i);var n={act:"stickers_gift_box",pack_id:e,peers:t,ref:(r=r||{}).ref};return r.from&&(n.from=r.from),n.sticker_referrer=r.sticker_referrer||"store",boxLayerWrap.scrollTop=0,showBox("/al_im.php",n,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),cancelEvent(i)},showStickerTT:function(e){var t=e.getAttribute("data-title");t&&Object(F.showTooltip)(e,{text:t,slide:15,shift:[74-getSize(e)[0]/2,120,5],className:"sticker_hint_tt",hasover:1})},scrollToStickerPack:function(e,t,i){var r=hi.opts[e],n=ge("emoji_tab_cont_"+t+"_"+e),o=n&&t!=hi.tabDefaultId?n.offsetTop+getSize(n)[1]:0;r.scrollAnimation=1,r.emojiScroll.scrollTop(o,i?0:200,(function(){r.scrollAnimation=0})),hi.scrollToTab(t,e)},toggleStickers:function(e,t){var i=hi.opts[e];i&&i.tt?(i.noStickers=t,toggleClass(i.tt,"emoji_no_tabs",t),i.curTab&&hi.tabSwitch(0,0,e)):i&&(i.hideStickersInitial=t)},getSizeCached:function(e){return(e=ge(e))?(void 0!==e[hi.CACHED_WIDTH_PROP]&&void 0!==e[hi.CACHED_HEIGHT_PROP]||(e[hi.CACHED_WIDTH_PROP]=e.offsetWidth,e[hi.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[hi.CACHED_WIDTH_PROP],e[hi.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=ge(e))&&(e[hi.CACHED_WIDTH_PROP]=void 0,e[hi.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=hi.opts[t];return i&&"stories"===i.ref?hi.STICKER_REFERRERS.STORY_KEYBOARD:e===hi.TAB_RECENT_STICKERS?hi.STICKER_REFERRERS.RECENT:e===hi.TAB_FAVORITE_STICKERS?hi.STICKER_REFERRERS.FAVORITE:hi.STICKER_REFERRERS.KEYBOARD},render:{sticker:function(e,t,i){var r=hi.render.stickerRs(e,t,i);return se(r)},stickerRs:function(e,t,i){var r={optId:e,selId:t,stickerId:i[0],size:i[1]?i[1]:256,stickerUrl:i[2],fav:i[4]||"",favHash:i[5]||"",referrer:hi.getStickerReferrer(t,e),favClass:i[4]?"faved":""},n="";if(browser.msie&&!browser.msie_edge||!i[3])n=hi.stickerItem();else{n=hi.stickerItemAnimation();var o=rand(1,1e5);r.animationUrl=i[3],r.uniqId=o}return rs(n,r)},stickerHintRs:function(e,t,i){var r=t,n="";if(t<0)n=window.promotedStickerUrls&&window.promotedStickerUrls[-r];else if(i)n=i[2];else{var o=ke(r);o&&(n=de(o,64,64))}var s=i?i[3]:"",a={optId:e,selId:0,stickerId:r,stickerUrl:n,class:r<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+r+", '"+n+"', this)"},c="";return(!browser.msie||browser.msie_edge)&&s&&n?(c=hi.hintsStickerItemAnimation(),a.animationUrl=s,a.class+=" sticker_animation"):n&&(c=hi.hintsStickerItem()),rs(c,a)},stickerContent:function(e,t,i){var r=attr(t,"data-animation-path"),n=attr(t,"data-src"),o="/images/blank.gif";i||(o=n);var s=attr(t,"data-sticker-id"),a=attr(t,"data-fav-hash"),c=attr(t,"data-fav"),l="";r?l='<div data-uniq-id="'+attr(t,"data-uniq-id")+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" class="sticker_animation" data-sticker-id="'+s+'" data-animation-path="'+r+'"><img class="sticker_img emoji_sticker_image" src="'+o+'" data-src="'+n+'"/></div>':l='<img class="emoji_sticker_image" src="'+o+'" data-src="'+n+'"/>';if(hi.favoriteAvailable){var d="";1==c&&(d="on"),l+=`<span role="link"\n               onmouseover="Emoji.favorite.reminder(this)"\n               class="emoji_sticker_item_fav ${d}"\n               data-sticker-id="${s}"\n               data-hash="${a}"\n               onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n               onclick="cancelEvent(event)"></span>`}return val(t,l),n}},__eof:1}},rudk:function(e,t,i){"use strict";i.r(t),i.d(t,"parseFwd",(function(){return a})),i.d(t,"convertKludgesToAttaches",(function(){return c})),i.d(t,"isReservedPeer",(function(){return l})),i.d(t,"isUserPeer",(function(){return d})),i.d(t,"isChatPeer",(function(){return u})),i.d(t,"isEmailPeer",(function(){return f})),i.d(t,"isContactPeer",(function(){return _})),i.d(t,"isCommunityPeer",(function(){return m})),i.d(t,"convertAttachesToPhpMedia",(function(){return p})),i.d(t,"isPinnedSortId",(function(){return h})),i.d(t,"isOnboardingFindFriendsLink",(function(){return v}));var r=i("jE6c"),n=i("hC3G");function o(e,t){void 0===t&&(t=[]);var i=e.split("_");return[i[0],i[1],t]}var s={};function a(e){if(s[e])return s[e];for(var t=e?e.length:0,i=[],r=[],n="",a=0;a<t;a++){var c=e[a],l=c.charCodeAt(0);l>=48&&l<=57||"_"===c||"-"===c?n+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==n&&(r.push(n),i.push("id"),n=""),r.push(c),i.push(c))}n.length>0&&(r.push(n),i.push("id"));var d=function e(t,i,r,n){if(void 0===r&&(r=0),void 0===n&&(n=0),n>50)return[[],t.length];for(var s=[],a="";r<t.length;){var c=t[r];if("id"===c)a=i[r];else if(","===c&&a)s.push(o(a)),a="";else if("("===c){var l=e(t,i,r+1,n+1),d=l[0];r=l[1],s.push(o(a,d)),a=""}else if(")"===c)return""!==a&&s.push(o(a)),[s,r];r++}return a&&s.push(o(a)),[s,r]}(i,r)[0];return Object.keys(s).length>300&&(s={}),s[e]=d,d}function c(e,t){var i=[];e.fwd_count?i.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&i.push({type:"mail",id:-t,object:{fwd_count:a(e.fwd).length}});for(var n=1;e["attach"+n+"_type"];++n)"call"===e["attach"+n+"_type"]?i.push({type:e["attach"+n+"_type"],id:e["attach"+n],initiatorId:Object(r.intval)(e["attach"+n+"_call_initiator_id"]),state:e["attach"+n+"_call_state"],duration:Object(r.intval)(e["attach"+n+"_call_duration"]),receiverId:Object(r.intval)(e["attach"+n+"_call_receiver_id"])}):i.push({type:e["attach"+n+"_type"],id:e["attach"+n],kind:e["attach"+n+"_kind"],productId:e["attach"+n+"_product_id"]});return e.geo&&i.push({type:"geo",id:e.geo}),i}function l(e){return 0==e}function d(e){return e>0&&e<2e9}function u(e){return e>2e9}function f(e){return e<-2e9}function _(e){return e>19e8&&e<2e9}function m(e){return e>-2e9&&e<0}function p(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}function h(e){return e>0&&(e|n.PINNED_CONVERSATION_BIT_MASK)===n.PINNED_CONVERSATION_BIT_MASK}function v(e){return/(^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com)?\/onboarding_find_friends/.test(decodeURIComponent(e))}}});