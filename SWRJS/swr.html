<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="common/bootstrap.min.css">
        <title>SWRJS</title>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-sm-12 col-md-2 col-lg-2 col-xl-2">
                    Short circuit at DUT-port
                    <textarea title="shortPortInput" id="shortPortInput" class="form-control">
271;168;
272;168;
273;168;
274;168;
275;168;
276;167;
277;167;
278;167;
279;167;
280;168;
281;168;
282;168;
283;168;
284;168;
285;168;
286;169;
287;169;
288;168;
289;168;
290;169;
291;170;
292;171;
293;170;
294;170;
295;171;
296;171;
297;172;
298;172;
299;172;
300;173;
301;172;
302;174;
303;174;
304;174;
305;174;
306;175;
307;175;
308;176;
309;175;
310;175;
311;175;
312;175;
313;174;
314;174;
315;174;
316;173;
317;172;
318;172;
319;170;
320;171;
321;169;
322;168;
323;168;
324;168;
325;167;
326;167;
327;167;
328;167;
329;167;
330;167;
331;167;
332;167;
333;167;
334;168;
335;168;
336;169;
337;168;
338;169;
339;168;
340;169;
341;169;
342;168;
343;169;
344;168;
345;169;
346;169;
347;170;
348;170;
349;170;
350;170;
351;170;
352;170;
353;170;
354;171;
355;171;
356;166;
357;166;
358;166;
359;166;
360;167;
361;166;
362;166;
363;167;
364;167;
365;166;
366;167;
367;166;
368;166;
369;166;
370;166;
371;166;
372;165;
373;165;
374;164;
375;164;
376;165;
377;165;
378;165;
379;164;
380;164;
381;165;
382;165;
383;165;
384;165;
385;165;
386;165;
387;165;
388;166;
389;167;
390;167;
391;167;
392;168;
393;169;
394;170;
395;170;
396;171;
397;172;
398;173;
399;174;
400;175;
401;175;
402;176;
403;177;
404;178;
405;179;
406;179;
407;179;
408;180;
409;180;
410;180;
411;179;
412;179;
413;178;
414;178;
415;178;
416;178;
417;178;
418;177;
419;177;
420;177;
421;176;
422;176;
423;177;
424;176;
425;175;
426;175;
427;176;
428;176;
429;175;
430;175;
431;175;
432;175;
433;176;
434;175;
435;175;
436;175;
437;175;
438;175;
439;174;
440;174;
441;173;
442;173;
443;172;
444;172;
445;171;
446;170;
447;169;
448;168;
449;167;
450;166;
451;166;
452;164;
453;163;
454;162;
455;159;
456;159;
457;158;
458;158;
459;158;
460;157;
461;157;
462;158;
463;158;
464;157;
465;157;
466;158;
467;158;
468;158;
469;158;
470;158;
471;159;
472;159;
473;159;
474;159;
475;159;
476;160;
477;159;
478;159;
479;159;
480;160;
481;159;
482;159;
483;159;
484;160;
485;160;
486;160;
487;160;
488;159;
489;159;
490;160;
491;160;
492;160;
493;160;
494;159;
495;159;
496;159;
497;158;
498;158;
499;159;
500;158;
501;158;
502;158;
503;157;
504;156;
505;157;
506;156;
507;156;
508;156;
509;155;
510;155;
511;154;
512;154;
513;154;
514;153;
515;152;
516;152;
517;151;
518;151;
519;151;
520;150;
521;149;
522;149;
523;149;
524;147;
525;148;
526;147;
527;147;
528;146;
529;146;
530;146;
531;146;
532;145;
533;145;
534;145;
535;145;
536;145;
537;145;
538;145;
539;145;
540;146;
541;146;
542;147;
543;147;
544;147;
545;147;
546;148;
547;148;
548;148;
549;148;
550;142;
551;143;
552;143;
553;143;
554;143;
555;142;
556;142;
557;142;
558;143;
559;143;
560;143;
561;143;
562;144;
563;144;
564;144;
565;144;
566;143;
567;144;
568;144;
569;144;
570;145;
571;144;
572;145;
573;144;
574;145;
575;145;
576;146;
577;146;
578;146;
579;146;
580;147;
581;146;
582;147;
583;147;
584;148;
585;148;
586;148;
587;149;
588;148;
589;149;
590;149;
591;149;
592;149;
593;150;
594;150;
595;151;
596;150;
597;151;
598;151;
599;152;
600;152;
601;152;
602;152;
603;152;
604;152;
605;152;
606;152;
607;153;
608;153;
609;154;
610;153;
611;154;
612;154;
613;154;
614;154;
615;155;
616;155;
617;154;
618;155;
619;155;
620;155;
621;155;
622;155;
623;155;
624;154;
625;155;
626;155;
627;155;
628;154;
629;154;
630;153;
631;154;
632;153;
633;153;
634;153;
635;152;
636;152;
                    </textarea>

                </div>
                <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-10">
                    <div class="chart-containerz" style="position: relative; height: 300px;">
                        <canvas id="shortPort_chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <form class="form-inline">
                        <div class="input-group mb-2 mr-sm-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">FREQ_FROM MHz</div>
                            </div>
                            <input id="freq_from" type="number" class="form-control" value="330"  />
                        </div>
                        <div class="input-group mb-2 mr-sm-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">FREQ_TO MHz</div>
                            </div>
                            <input id="freq_to" type="number" class="form-control" value="600" />
                        </div>
                        <div class="form-check mb-2 mr-sm-2">
                            <input class="form-check-input" type="checkbox" id="isUseshortPortCorrection">
                            <label class="form-check-label" for="inlineFormCheck">
                                use shortPort correction
                            </label>
                        </div>
                        <span class="btn btn-danger mb-2" id="freqs_range_apply">ok</span>
                    </form>
                </div>

            </div>
        </div>    

        <script src="common/jquery-3.2.1.slim.min.js"></script>
        <script src="common/bootstrap.bundle.min.js"></script>
        <script src="common/Chart.bundle.min.js"></script>

        <script type="text/javascript">
            var shortPort_values = []; //input values from device
            var shortPort_correction_coef = []; //coefficient for corrction
            var freq_from = 0; //MHz
            var freq_to = 0; //MHz
            var isUseshortPortCorrection = false;


            document.addEventListener('DOMContentLoaded', function () {
                freqs_range_apply();
            });

            function freqs_range_apply() {
                $('#freqs_range_apply').click(function () {
                    freq_from = parseInt($('#freq_from').val()); //MHz
                    freq_to = parseInt($('#freq_to').val()); //MHz
                    isUseshortPortCorrection = $("#isUseshortPortCorrection").prop('checked');

                    if (isUseshortPortCorrection) {
                        shortPort_fill();
                        shortPort_calc_correction_coef();
                        shortPort_draw();
                    }
                });
            }

            function shortPort_calc_correction_coef() {
                var i;
                var shortPort_values_freqsRange = [];
                for (i = freq_from; i <= freq_to; i++) {
                    shortPort_values_freqsRange.push(shortPort_values[i]);
                }

                var shortPort_values_freqsRange_max = Math.max.apply(null, shortPort_values_freqsRange);

                for (i = freq_from; i <= freq_to; i++) {
                    shortPort_correction_coef[i] = shortPort_values_freqsRange_max - shortPort_values[i];
                }

            }

            function shortPort_fill() {
                var res = $('#shortPortInput').val();
                var ar = res.split('\n');
                var tmp, freq, volt;
                $(ar).each(function (i, item) {
                    tmp = item.split(';');
                    freq = parseInt(tmp[0]);
                    volt = parseInt(tmp[1]);
                    if (freq > 0 && volt >= 0) {
                        //console.log('f=' + freq + ' v=' + volt);
                        shortPort_values[freq] = volt;
                    }
                });
            }

            function shortPort_draw() {
                var i;
                var dataLabels = [];
                var dataY_shortPort_values = [];
                for (i = freq_from; i <= freq_to; i++) {
                    dataLabels.push(i);
                    dataY_shortPort_values.push(shortPort_values[i]);
                }

                var dataY_shortPort_correction_coef = [];
                for (i = freq_from; i <= freq_to; i++) {
                    dataY_shortPort_correction_coef.push(shortPort_correction_coef[i]);
                }

                var ctx = document.getElementById('shortPort_chart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dataLabels,
                        datasets: [
                            {
                                label: 'shortPort',
                                fill: false,
                                backgroundColor: 'rgb(255, 99, 132)',
                                borderWidth: 3,
                                borderColor: 'rgb(255, 99, 132)',
                                pointStyle: 'circle',
                                radius: 1,
                                data: dataY_shortPort_values
                            },
                            {
                                label: 'shortPort_correction_coef',
                                fill: false,
                                backgroundColor: 'rgb(255, 159, 64)',
                                borderWidth: 3,
                                borderColor: 'rgb(255, 159, 64)',
                                pointStyle: 'circle',
                                radius: 1,
                                data: dataY_shortPort_correction_coef
                            }
                        ]
                    },
                    options: {
                        elements: {
                            line: {
                                tension: 0, // disables bezier curves
                            }
                        },
                        animation: {
                            duration: 0, // general animation time
                        },
                        hover: {
                            animationDuration: 0, // duration of animations when hovering an item
                        },
                        responsiveAnimationDuration: 0,
                        maintainAspectRatio: false,

                        //responsive: true,
                        //hover: {
                        //mode: 'nearest',
                        //intersect: true
                        //}
                    }
                });

                //chart.canvas.parentNode.style.height = '128px';
            }
            /*
             red: 'rgb(255, 99, 132)',
             orange: 'rgb(255, 159, 64)',
             yellow: 'rgb(255, 205, 86)',
             green: 'rgb(75, 192, 192)',
             blue: 'rgb(54, 162, 235)',
             purple: 'rgb(153, 102, 255)',
             grey: 'rgb(201, 203, 207)'
             */
        </script>

    </body>
</html>